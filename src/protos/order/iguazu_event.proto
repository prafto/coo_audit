syntax = "proto3";

// buf:lint:ignore DIRECTORY_SAME_PACKAGE
package order_service_iguazu_event.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "order/consumer_order.proto";
import "order/merchant_comms.proto";

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.order_service_iguazu_event";

// Iguazu Event for logging Order Ready Signal from Mx
message OrderReadySignalEvent {
  // Store ID
  google.protobuf.StringValue store_id = 1;
  // Delivery ID
  google.protobuf.StringValue delivery_id = 2;
  // Delivery creation time
  google.protobuf.Timestamp created_at = 3;
  // Source of order ready signal, values in ["mx-mobile-bff/confirm-order-ready-for-pickup", "mx-integrations/confirm-order-ready-for-pickup" etc]
  google.protobuf.StringValue source = 4;
  // Order protocol types, values in ["point_of_sale", "ipad", "drive", "fax", "phone" etc]
  google.protobuf.StringValue order_protocol = 5;
  // Fulfillment types, values in ["dasher","consumer_pickup","merchant_fleet", "shipping"]
  google.protobuf.StringValue fulfillment_type = 6;
  // Dx assigned delivery time
  google.protobuf.StringValue dasher_assigned_time = 7;
  // Dx confirmed at store time
  google.protobuf.StringValue dasher_confirmed_at_store_time = 8;
}

// Iguazu Event for logging AYO notifications pushed to merchants
message PushNotificationToMerchantsEvent {
  // Store ID
  google.protobuf.StringValue store_id = 1;
  // Notification type
  merchant_comms.PushNotificationType push_notification_type = 2;
  // AYO notification config
  oneof payload {
    // AYO notification config
    merchant_comms.AreYouOpenPushNotificationConfig are_you_open_config = 3;
    // AYO notification config specific for DRSC
    merchant_comms.DrscAreYouOpenPushNotificationConfig drsc_are_you_open_config = 4;
  }
  // Client where the notification is triggered
  google.protobuf.StringValue client_source = 5;
  // Status of push notification event
  google.protobuf.StringValue job_status = 6;
}

// A tracking event that records the remaining traffic of primary phone and fax order protocol
// after deprecation
message OrderProtocolDeprecationEvent {
  // storeId of the store
  google.protobuf.StringValue store_id = 1;

  // businessId of the store
  google.protobuf.StringValue business_id = 2;

  // DeliveryId of the order
  google.protobuf.StringValue delivery_id = 3;

  // order protocol type of the remaining traffic
  google.protobuf.StringValue order_protocol_type = 4;

  // UTC time when this happens
  google.protobuf.Timestamp created_at = 5;

  // record whether the traffic is from primary order protocol and fallback protocol
  google.protobuf.BoolValue is_primary = 6;
}

// Iguazu Event for Dasher Active Time project
message DasherActiveTimeEvent {
  // Specifies when the redirection happens
  enum RedirectionFlow {
    // Unknown flow
    REDIRECTION_FLOW_UNSPECIFIED = 0;
    // Redirection at checkout
    REDIRECTION_FLOW_CHECKOUT = 1;
    // Redirection after checkout and proactively i.e. VRP/extended HULK
    REDIRECTION_FLOW_POST_CHECKOUT_FULL_ORDER_PROACTIVE = 2;
  }

  // consumer id
  google.protobuf.StringValue consumer_id = 1;

  // cart uuid from the createOrderFromCart request
  google.protobuf.StringValue original_cart_uuid = 2;

  // cart uuid from the redirected cart generated by fulfillment planner
  google.protobuf.StringValue redirected_cart_uuid = 3;

  // order uuid of consumer parent order
  google.protobuf.StringValue consumer_order_uuid = 4;

  // order uuid list of merchant child orders
  repeated google.protobuf.StringValue merchant_order_uuid_list = 5;

  // flag to indicate if redirection is successful
  google.protobuf.BoolValue is_redirection_succeeded = 6;

  // reason if redirection failed
  google.protobuf.StringValue redirection_failure_reason = 7;

  // flag to indicate if checkout is successful
  google.protobuf.BoolValue is_checkout_succeeded = 8;

  // reason if checkout failed
  google.protobuf.StringValue checkout_failure_reason = 9;

  reserved 10;
  reserved "parent_order_pricing_breakdown";
  reserved 11;
  reserved "child_order_pricing_breakdown";
  reserved 12;
  reserved "child_order_pricing_info";
  reserved 13;
  reserved "parent_order_pricing_info";

  // original store id
  google.protobuf.StringValue original_store_id = 14;

  // redirected store id
  google.protobuf.StringValue redirected_store_id = 15;

  // merchant order pricing info
  google.protobuf.StringValue merchant_order_pricing_info = 16;

  // consumer order pricing info
  google.protobuf.StringValue consumer_order_pricing_info = 17;

  // Flow when we do redirection
  RedirectionFlow redirection_flow = 18;
}

// Order service Order Cart Adjustment success event
message OSOCASuccessEvent {
  // order_uuid in adjustmentOrder
  google.protobuf.StringValue order_uuid = 1;
  //delivery_uuid in adjustmentOrder
  google.protobuf.StringValue delivery_uuid = 2;
  // adjustment_type in adjustmentOrder
  google.protobuf.StringValue adjustment_type = 3;
  // adjustment_source in adjustmentOrder
  google.protobuf.StringValue adjustment_source = 4;
  // hash of the sanitized adjust_order_request to dedup order adjustment
  google.protobuf.StringValue oca_id = 5;
  // timestamp for when adjustOrder happens
  google.protobuf.Timestamp timestamp = 6;
  // adjust_order_request
  google.protobuf.StringValue adjust_order_request_str = 7;
  // adjust_order_response
  google.protobuf.StringValue adjust_order_response_str = 8;
  // AdjustOrder caller name
  google.protobuf.StringValue caller_name = 14;
}

// Order service Order Cart Adjustment failure event
message OSOCAFailureEvent {
  // order_uuid in adjustmentOrder
  google.protobuf.StringValue order_uuid = 1;
  //delivery_uuid in adjustmentOrder
  google.protobuf.StringValue delivery_uuid = 2;
  // error_type in adjustmentOrder
  google.protobuf.StringValue error_type = 3;
  // error_message in adjustmentOrder
  google.protobuf.StringValue error_message = 4;
  // error_domain in adjustmentOrder
  google.protobuf.StringValue error_domain = 5;

  // adjustment_type in adjustmentOrder
  google.protobuf.StringValue adjustment_type = 6;
  // adjustment_source in adjustmentOrder
  google.protobuf.StringValue adjustment_source = 7;

  reserved 8, 9;
  reserved "adjust_order_request", "adjust_order_response";

  // hash of the sanitized adjust_order_request to dedup OCA failures from retry
  google.protobuf.StringValue oca_id = 10;

  // timestamp for when adjustOrder failure happens
  google.protobuf.Timestamp timestamp = 11;

  // adjust_order_request
  google.protobuf.StringValue adjust_order_request_str = 12;
  // adjust_order_response
  google.protobuf.StringValue adjust_order_response_str = 13;
  // AdjustOrder caller name
  google.protobuf.StringValue caller_name = 14;
}

// Order service Order Cart Adjustment failure order quote event
message OSOCAFailureOrderQuoteEvent {
  // order_uuid in adjustmentOrder
  google.protobuf.StringValue order_uuid = 1;
  //delivery_uuid in adjustmentOrder
  google.protobuf.StringValue delivery_uuid = 2;
  // hash of the sanitized adjust_order_request to dedup OCA failures from retry
  google.protobuf.StringValue oca_id = 3;
  // timestamp for when adjustOrder order quote event happens
  google.protobuf.Timestamp timestamp = 4;
  // currency used for the order adjustment
  google.protobuf.StringValue currency = 5;
  // order quote grand total before adjustment
  google.protobuf.Int32Value old_order_quote_grand_total = 6;
  // order quote grand total after adjustment
  google.protobuf.Int32Value new_order_quote_grand_total = 7;
  // order quote grand total delta
  google.protobuf.Int32Value order_quote_grand_total_delta = 8;
  // tracking uuid to joint with pricing's order quote table
  google.protobuf.StringValue tracking_uuid = 9;
  // order quote grand total in string before adjustment
  google.protobuf.StringValue old_order_quote_grand_total_str = 10;
  // order quote grand total in string after adjustment
  google.protobuf.StringValue new_order_quote_grand_total_str = 11;
}
