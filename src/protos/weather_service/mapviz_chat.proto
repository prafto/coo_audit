syntax = "proto3";

package weather_service.v1;

import "common/service_client_config.proto";
import "doordash.api/annotations.proto";
import "doordash.api/client.proto";
import "doordash.api/field_validate.proto";
import "google/api/annotations.proto";
import "google/protobuf/wrappers.proto";

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.weather_service";

// This is a service that receives user inputs which are natural language instructions to update the UI of mapviz.
// The service communicates with an LM to create a JSON configuration, which is sent to the back of the user.
service MapvizChatService {
  option (doordash.api.service) = {
    name: "mapviz-chat-service"
    url: "weather-service-web.service.prod.ddsd"
    port: 50051
    name_spaces: ["mapviz"]
    owner: {
      id: "weather-service-default-bucket" // this is the chronosphere bucket slug
      name: "weather-service"
      slack_channel: "#mid-eng"
      email_alias: "eng-mid@doordash.com"
    }
    target_products: [INTERNAL]
  };

  // Returns the mapviz configuration provided by the LM
  rpc GetLMConfiguration(GetLMConfigurationRequest) returns (GetLMConfigurationResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 45000;

    option (google.api.http) = {
      post: "/mapviz/v1/getLMConfiguration"
      body: "*"
    };

    option (doordash.api.endpoint) = {
      tier: T2
      lifecycle: DEV
      authorization: [NONE]
    };
  }
}

// Request, which contains natural language user input asking for some modification to the mapviz UI
message GetLMConfigurationRequest {
  // Represents the user input into the chat bar. E.g., "make the radius of the dasher path much larger"
  google.protobuf.StringValue user_input = 1;

  // Represents the current configuration of mapviz.
  google.protobuf.StringValue mapviz_current_config_json = 2;

  // Represents the serialized data of the dasher_path (note: this field is subject to change. May add many more of these fields encoding delivery data).
  repeated google.protobuf.StringValue dasher_path_data = 3;
}

// Response, which contains JSON configuration to update the mapviz UI
message GetLMConfigurationResponse {
  // Represents the mapviz configuration generated by the LM.
  google.protobuf.StringValue mapviz_lm_config_json = 2;
}
