syntax = "proto3";

import "common/service_client_config.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/doordash/services-protobuf/generated/geo_intelligence";
option java_generic_services = true;
option java_multiple_files = true;
option java_outer_classname = "GoogleBillableDelivery";
option java_package = "geo.intelligence.google.billable.delivery.proto";

// Note: delivery_uuid is represented as delivery_id in this schema in most places

// api used for handling delivery billing for google maps api
service GoogleBillableDeliveryService {
  option (service_client.client_config).service_name = "geo-intelligence";
  option (service_client.client_config).service_app = "web";

  // associate delivery_correlation_id with delivery_id for billing purpose
  rpc UpdateGoogleBillableDelivery(UpdateGoogleBillableDeliveryRequest) returns (UpdateGoogleBillableDeliveryResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 300;
  }
  // get all delivery_correlation_id for a delivery_id
  rpc GetGoogleBillableDelivery(GetGoogleBillableDeliveryRequest) returns (GetGoogleBillableDeliveryResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 300;
  }
}

// request for update billable api
message UpdateGoogleBillableDeliveryRequest {
  // delivery uuid
  repeated google.protobuf.StringValue delivery_id = 1;
  // client delivery identifier before delivery_id is created
  google.protobuf.StringValue delivery_correlation_id = 2;
  // client identifier. ios_cx. format <platform>_<app>
  google.protobuf.StringValue client_identifier = 3;
  // order cart ID, generated by Order Service after an order is created
  google.protobuf.StringValue order_cart_id = 4;
}

// response
message UpdateGoogleBillableDeliveryResponse {}

// request to get billable delivery sessions
message GetGoogleBillableDeliveryRequest {
  // delivery uuid
  google.protobuf.StringValue delivery_uuid = 1;
  // delivery id long
  google.protobuf.Int64Value delivery_id = 2;
}

// delivery correlation message
message DeliveryCorrelation {
  // delivery correlation id
  google.protobuf.StringValue id = 1;
  // client identifier. ios_cx. format <platform>_<app>
  google.protobuf.StringValue client_identifier = 2;
}

// response for billable delivery request
message GetGoogleBillableDeliveryResponse {
  // delivery uuid
  google.protobuf.StringValue delivery_id = 1;
  // client delivery identifier before delivery_id is created
  repeated DeliveryCorrelation delivery_correlation = 2;
}
