syntax = "proto3";

package delivery_service.core;

import "common/common.proto";
import "common/date.proto";
import "common/order.proto";
import "common/order_config.proto";
import "common/restriction_rules.proto";
import "common/service_client_config.proto";
import "dasher_handoffs_service/dasher_handoffs_entity.proto";
import "delivery_service/eta_prediction.proto";
import "doordash.api/annotations.proto";
import "google/api/annotations.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "task_service/common.proto";

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.delivery.core";

service DeliveryCoreService {
  option (doordash.api.service) = {
    name: "delivery-service"
    url: "delivery-service-web.service.prod.ddsd"
    port: 50051
    name_spaces: ["delivery-service"]
    api_key_name: "DELIVERY_SERVICE_API_KEY"
    owner: {
      id: "logistics-platform"
      name: "delivery-service"
      slack_channel: "#eng-logistics-infra"
      email_alias: "eng-logistics-platform@doordash.com"
    }
    target_products: [INTERNAL]
  };

  option (service_client.client_config).service_name = "delivery-service";
  option (service_client.client_config).retry_config.max_attempts = 2;
  option (service_client.client_config).response_attempt_timeout_millis = 500;
  option (service_client.client_config).circuit_breaker_config.failure_rate_threshold = 0.8;

  rpc GetDeliveriesByIds(GetDeliveriesByIdsRequest) returns (GetDeliveriesByIdsResponse);

  rpc GetOrCreateDelivery(CreateDeliveryRequest) returns (CreateDeliveryResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 5000;
  }

  rpc GetOrCreateDeliveryV2(CreateDeliveryV2Request) returns (CreateDeliveryV2Response) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 5000;
  }

  rpc DasherConfirmDeliveries(DasherConfirmDeliveriesRequest) returns (DasherConfirmDeliveriesResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 2000;
  }

  rpc GetDeliveryInfo(GetDeliveryInfoRequest) returns (GetDeliveryInfoResponse);

  rpc GetDeliveryById(DeliveryRequest) returns (DeliveryResponse);

  rpc GetDeliveryByPublicId(DeliveryRequestPublicId) returns (DeliveryResponse);

  rpc GetDeliveryByUuid(GetDeliveryByUuidRequest) returns (DeliveryResponse);

  rpc GetDeliveriesByUuids(GetDeliveriesByUuidsRequest) returns (GetDeliveriesByUuidsResponse);

  rpc GetDeliveriesByBatchId(GetDeliveriesByBatchIdRequest) returns (GetDeliveriesByBatchIdResponse) {
    option (google.api.http) = {get: "/delivery-service/v1/deliveries/{batch_id}"};

    option (doordash.api.endpoint) = {
      tier: T0
      lifecycle: DEV
      authorization: [DD_USER]
      target_products: [INTERNAL]
    };
  }

  rpc DasherConfirmDelivery(DasherConfirmDeliveryRequest) returns (DasherConfirmDeliveryResponse);

  rpc DasherConfirmAtStore(DasherConfirmAtStoreRequest) returns (DasherConfirmAtStoreResponse);

  rpc DasherConfirmAtConsumer(DasherConfirmAtConsumerRequest) returns (DasherConfirmAtConsumerResponse);

  rpc DasherArrivingAtStore(DasherArrivingAtStoreRequest) returns (DasherArrivingAtStoreResponse);

  rpc DasherArrivingAtConsumer(DasherArrivingAtConsumerRequest) returns (DasherArrivingAtConsumerResponse);

  rpc DasherLeavingStore(DasherLeavingStoreRequest) returns (DasherLeavingStoreResponse);

  rpc StoreDasherApproachingCustomerTime(StoreDasherApproachingCustomerTimeRequest) returns (google.protobuf.Empty);

  rpc StoreDasherApproachingCustomerWideTime(StoreDasherApproachingCustomerWideTimeRequest) returns (google.protobuf.Empty);

  rpc GetDasherProximityInfo(GetDasherProximityInfoRequest) returns (GetDasherProximityInfoResponse);

  rpc PickUpDelivery(DeliveryPickUpRequest) returns (DeliveryPickUpResponse);

  rpc DropOffDelivery(DeliveryDropOffRequest) returns (DeliveryDropOffResponse);

  rpc AbandonDelivery(DeliveryAbandonRequest) returns (DeliveryAbandonResponse);

  rpc GetDeliveryAbandonedInfo(GetDeliveryAbandonRequest) returns (GetDeliveryAbandonResponse);

  rpc RevertDropOffDelivery(RevertDeliveryDropOffRequest) returns (RevertDeliveryDropOffResponse);

  rpc RevertDeliveryPickup(RevertDeliveryPickupRequest) returns (RevertDeliveryPickupResponse);

  rpc CreateDeliveryFromOrderCart(CreateDeliveryFromOrderCartRequest) returns (CreateDeliveryFromOrderCartResponse);

  rpc CancelDelivery(CancelDeliveryRequest) returns (ActionResponse);

  rpc CancelDeliveryV2(CancelDeliveryRequestV2) returns (ActionResponse);

  rpc UpdateBatchId(UpdateBatchIdRequest) returns (UpdateBatchIdResponse);

  rpc UpdateShiftId(UpdateShiftIdRequest) returns (UpdateShiftIdResponse);

  rpc UpdateDeliveryOrderProtocolType(UpdateDeliveryOrderProtocolTypeRequest) returns (UpdateDeliveryOrderProtocolTypeResponse);

  rpc UpdateDasherWaitUntil(UpdateDasherWaitUntilRequest) returns (UpdateDasherWaitUntilResponse);

  rpc UpdateCustomerUnavailableEscalatedAt(UpdateCustomerUnavailableEscalatedAtRequest) returns (google.protobuf.Empty);

  rpc UpdateOrderConfirmedTimeAndPrepTime(UpdateOrderConfirmedTimeAndPrepTimeRequest) returns (UpdateOrderConfirmedTimeAndPrepTimeResponse);

  rpc UpdateOrderConfirmedTime(UpdateOrderConfirmedTimeRequest) returns (UpdateOrderConfirmedTimeResponse);

  rpc UpdateOrderReadyTime(UpdateOrderReadyTimeRequest) returns (UpdateOrderReadyTimeResponse);

  rpc UpdateOrderReadyTimeInBulk(UpdateOrderReadyTimeInBulkRequest) returns (UpdateOrderReadyTimeInBulkResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 2000;
  }

  rpc UpdateShouldBeManuallyAssigned(UpdateShouldBeManuallyAssignedRequest) returns (UpdateShouldBeManuallyAssignedResponse);

  rpc UpdateDeliveryToPickup(UpdateDeliveryToPickupRequest) returns (UpdateDeliveryToPickupResponse);

  rpc UpdateDeliveryIsDepot(UpdateDeliveryIsDepotRequest) returns (UpdateDeliveryIsDepotResponse);

  rpc CloseDelivery(CloseDeliveryRequest) returns (CloseDeliveryResponse);

  rpc CloseMerchantFulfilledDelivery(CloseMerchantFulfilledDeliveryRequest) returns (CloseMerchantFulfilledDeliveryResponse);

  rpc ConsumerPickedUp(ConsumerPickedUpRequest) returns (ConsumerPickedUpResponse);

  rpc GetDeliveryAudienceInfo(DeliveryRequest) returns (DeliveryAudienceInfoResponse) {
    option (google.api.http) = {
      post: "/delivery-service/v1/delivery/{delivery_id}/audienceInfo"
      body: "*"
    };

    option (doordash.api.endpoint) = {
      tier: T0
      lifecycle: DEV
      authorization: [DD_USER]
      target_products: [INTERNAL]
    };
  }

  rpc UpdateDeliveryAudienceInfo(UpdateDeliveryAudienceInfoRequest) returns (UpdateDeliveryAudienceInfoResponse);

  // GetAudienceInfo should be only used for delivery which are created after 2021-01-01.
  rpc GetAudienceInfo(GetAudienceInfoRequest) returns (DeliveryAudienceInfoResponse);

  rpc AssignDelivery(AssignDeliveryRequest) returns (AssignDeliveryResponse);

  rpc GetDeliveryOrderInfo(DeliveryRequest) returns (DeliveryOrderInfoResponse);

  rpc UnassignDelivery(UnassignDeliveryRequest) returns (UnassignDeliveryResponse);

  rpc UpdateMerchantTransactionId(UpdateMerchantTransactionIdRequest) returns (UpdateMerchantTransactionIdResponse);

  rpc GetDeliveriesByMerchantTransactionIds(GetDeliveriesByMerchantTransactionIdsRequest) returns (GetDeliveriesByMerchantTransactionIdsResponse);

  rpc GetDeliveryByIdForMerchantFinancialService(DeliveryRequest) returns (DeliveryForMerchantFinancialServiceResponse);

  rpc GetPreferenceForDasher(PreferenceForDasherRequest) returns (PreferenceForDasherResponse);

  rpc CreatePreferenceForDasher(PreferenceForDasherRequest) returns (PreferenceForDasherResponse);

  rpc ListPreferenceForDasher(ListPreferenceForDasherRequest) returns (ListPreferenceForDasherResponse);

  rpc GetDeliveryUuidsToIdsMap(GetDeliveryUuidsToIdsMapRequest) returns (GetDeliveryUuidsToIdsMapResponse);

  rpc GetDeliveryIdsToUuidsMap(GetDeliveryIdsToUuidsMapRequest) returns (GetDeliveryIdsToUuidsMapResponse);

  rpc GetDeliveryAssignmentConstraint(GetDeliveryAssignmentConstraintRequest) returns (GetDeliveryAssignmentConstraintResponse);

  rpc UpdateDeliveryAssignmentConstraint(UpdateDeliveryAssignmentConstraintRequest) returns (google.protobuf.Empty);

  rpc UpdateDeliveryCartIds(UpdateDeliveryCartIdsRequest) returns (google.protobuf.Empty);

  rpc IsReturnDelivery(IsReturnDeliveryRequest) returns (IsReturnDeliveryResponse);

  rpc HasReturnDelivery(HasReturnDeliveryRequest) returns (HasReturnDeliveryResponse);

  rpc UpdateDeliveryMonetaryFields(UpdateDeliveryMonetaryFieldsRequest) returns (UpdateDeliveryMonetaryFieldsResponse);

  rpc RescheduleDelivery(RescheduleDeliveryRequest) returns (DeliveryResponse);

  rpc UpdateParkingSpotInfo(UpdateParkingSpotInfoRequest) returns (google.protobuf.Empty);

  // First 500 delivery_ids sorted by created_at in DESC order are returned.
  rpc GetDeliveryIdsByRecipientUserIdFromAudienceInfo(GetDeliveryIdsByRecipientUserIdFromAudienceInfoRequest) returns (GetDeliveryIdsByRecipientUserIdFromAudienceInfoResponse);

  rpc GetDeliveryIdsByOrderCartIds(GetDeliveryIdsByOrderCartIdsRequest) returns (GetDeliveryIdsByOrderCartIdsResponse);

  rpc GetDeliveryIdsByStoreOrderCartIds(GetDeliveryIdsByStoreOrderCartIdsRequest) returns (GetDeliveryIdsByStoreOrderCartIdsResponse);

  rpc HasContactlessDasherInstructions(HasContactlessDasherInstructionsRequest) returns (HasContactlessDasherInstructionsResponse);

  rpc GetDeliveryByIdempotencyKey(GetDeliveryByIdempotencyKeyRequest) returns (DeliveryResponse);

  rpc UpdateDropoffFlags(UpdateDropoffFlagsRequest) returns (UpdateDropoffFlagsResponse);

  rpc UpdateMinAgeRequired(UpdateMinAgeRequiredRequest) returns (UpdateMinAgeRequiredResponse);

  rpc GetDeliveryUuidsByQuotedDeliveryTime(GetDeliveryUuidsByQuotedDeliveryTimeRequest) returns (GetDeliveryUuidsByQuotedDeliveryTimeResponse);

  rpc GetDeliveriesByQuotedDeliveryTime(GetDeliveriesByQuotedDeliveryTimeRequest) returns (GetDeliveriesByQuotedDeliveryTimeResponse);

  rpc VerifyDelivery(DeliveryVerificationRequest) returns (DeliveryVerificationResponse);

  rpc GetStartUpProbe(GetStartUpProbeRequest) returns (GetStartUpProbeResponse);

  // temporary bridging api, only for use in the task service synchronizer
  rpc GetOrCreateDeliveryWithId(CreateDeliveryWithIdRequest) returns (CreateDeliveryResponse) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 5000;
  }

  // temporary bridging api, only for use in the task service synchronizer
  rpc GetOrCreateDeliveryV2WithId(CreateDeliveryV2WithIdRequest) returns (CreateDeliveryV2Response) {
    option (service_client.client_method_config).response_attempt_timeout_millis = 5000;
  }

  // Update the OOS status for an item in Delivery Order Info
  rpc UpdateOutOfStockStatus(UpdateOutOfStockStatusRequest) returns (UpdateOutOfStockStatusResponse);

  // Manually publish DLC events for a delivery
  rpc PublishDeliveryLifecycleEvents(PublishDeliveryLifecycleEventsRequest) returns (PublishDeliveryLifecycleEventsResponse);

  // Update Delivery Order Items
  rpc UpdateDeliveryOrderItems(UpdateDeliveryOrderItemsRequest) returns (UpdateDeliveryOrderItemsResponse);

  // Returns a static version of Delivery, attributes which never change
  rpc GetStaticLiteDelivery(GetStaticLiteDeliveryRequest) returns (GetStaticLiteDeliveryResponse);
}

message GetStartUpProbeRequest {}

message GetStartUpProbeResponse {
  bool ready = 1;
}

message UpdateDropoffFlagsRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.BoolValue signature_required = 2;
  google.protobuf.BoolValue allow_unattended_delivery = 3;
}

message UpdateDropoffFlagsResponse {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Timestamp updated_at = 2;
}

message UpdateMinAgeRequiredRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Int32Value min_age_required = 2;
}

message UpdateMinAgeRequiredResponse {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Timestamp updated_at = 2;
}

message GetDeliveryByIdempotencyKeyRequest {
  google.protobuf.StringValue idempotency_key = 1;
}

message GetDeliveryIdsByStoreOrderCartIdsRequest {
  repeated google.protobuf.Int64Value store_order_cart_ids = 1;
}

message GetDeliveryIdsByStoreOrderCartIdsResponse {
  repeated int64 delivery_ids = 1;
}

message GetDeliveryIdsByOrderCartIdsRequest {
  repeated google.protobuf.Int64Value order_cart_ids = 1;
}

message GetDeliveryIdsByOrderCartIdsResponse {
  repeated int64 delivery_ids = 1;
}

message GetDeliveryIdsByRecipientUserIdFromAudienceInfoRequest {
  google.protobuf.Int64Value recipient_user_id = 1;
}

message GetDeliveryIdsByRecipientUserIdFromAudienceInfoResponse {
  repeated google.protobuf.Int64Value delivery_ids = 1;
}

message UpdateDeliveryCartIdsRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Int64Value store_order_cart_id = 2;
  google.protobuf.Int64Value order_cart_id = 3;
}

message GetDeliveryUuidsToIdsMapRequest {
  repeated google.protobuf.StringValue delivery_uuids = 1;
}

message GetDeliveryUuidsToIdsMapResponse {
  map<string, int64> delivery_uuids_to_ids_map = 1;
}

message GetDeliveryIdsToUuidsMapRequest {
  repeated int64 delivery_ids = 1;
}

message GetDeliveryIdsToUuidsMapResponse {
  map<int64, google.protobuf.StringValue> delivery_ids_to_uuids_map = 1;
}

message GetDeliveryByUuidRequest {
  google.protobuf.StringValue delivery_uuid = 1;
}

message GetDeliveriesByUuidsRequest {
  // Error thrown if list of delivery_uuids exceeds a limit (100 uuids)
  repeated google.protobuf.StringValue delivery_uuids = 1;
}

message GetDeliveriesByUuidsResponse {
  map<string, DeliveryResponse> deliveries = 1;
}

message GetDeliveriesByBatchIdRequest {
  google.protobuf.Int64Value batch_id = 1;
}

message GetDeliveriesByBatchIdResponse {
  map<int64, DeliveryResponse> deliveries = 1;
}

message DeliveryRequest {
  int64 delivery_id = 1;
}

message GetDeliveryInfoRequest {
  oneof identifier {
    int64 delivery_id = 1;
    google.protobuf.StringValue delivery_uuid = 2;
  }
  google.protobuf.FieldMask delivery_info_mask = 3;
}

// Response will contain fields based on the mask provided in the request, other fields will be null
// If no mask is provided, all fields will be returned
message GetDeliveryInfoResponse {
  DeliveryResponse delivery_data = 1;
  DeliveryAudienceInfoResponse delivery_audience_info = 2;
  DeliveryOrderInfoResponse delivery_order_info = 3;
  DeliveryAssignmentConstraint delivery_assignment_constraint = 4;
  IsReturnDeliveryResponse return_delivery = 5;
  HasReturnDeliveryResponse has_return_delivery = 6;
}

message DeliveryIdentifier {
  google.protobuf.Int64Value delivery_id = 1;
  google.protobuf.StringValue delivery_uuid = 2;
}

message GetAudienceInfoRequest {
  int64 delivery_id = 1;
  bool require_dasher_data = 2;
}

message DeliveryRequestPublicId {
  string public_id = 1;
}

message DeliveryResponse {
  reserved 24, 49;
  int64 delivery_id = 1;
  string public_id = 2;
  google.protobuf.Timestamp abandoned_at = 3;
  google.protobuf.Timestamp actual_delivery_time = 4;
  google.protobuf.Timestamp actual_pickup_time = 5;
  google.protobuf.Int64Value cash_on_delivery = 6;
  google.protobuf.Timestamp dasher_confirmed_time = 7;
  google.protobuf.Int64Value shift_id = 8;
  google.protobuf.StringValue fulfillment_type = 9;
  google.protobuf.Int64Value pickup_address_id = 10;
  google.protobuf.Int64Value delivery_address_id = 11;
  google.protobuf.Timestamp quoted_delivery_time = 12;
  bool is_asap = 13;
  google.protobuf.BoolValue is_consumer_pickup = 14;
  google.protobuf.Int64Value value_of_contents = 15;
  bool is_from_store_to_us = 16;
  google.protobuf.StringValue source = 17;
  bool manually_assigned = 18;
  google.protobuf.Int64Value onsite_estimated_prep_time = 19;
  bool should_be_manually_assigned = 20;
  google.protobuf.BoolValue signature_required = 21;
  google.protobuf.Int64Value submarket = 22;
  google.protobuf.Timestamp dasher_at_store_time = 23;
  google.protobuf.Timestamp dasher_assigned_time = 25;
  google.protobuf.Int64Value parent_delivery_id = 26;
  google.protobuf.Timestamp cancelled_at = 27;
  google.protobuf.Int64Value store_order_cart_id = 28;
  google.protobuf.Int64Value order_cart_id = 29;
  int64 store_id = 30;
  google.protobuf.Timestamp dasher_confirmed_at_consumer_time = 31;
  google.protobuf.Timestamp dasher_confirmed_at_store_time = 32;
  google.protobuf.Int64Value eta_prediction_id = 33;
  google.protobuf.StringValue currency = 34;
  google.protobuf.StringValue google_estimate = 35;
  google.protobuf.Timestamp estimated_store_prep_time = 36;
  google.protobuf.Int64Value pre_delivery_tip_amount = 37;
  google.protobuf.StringValue pickup_location_info = 38;
  google.protobuf.StringValue dropoff_location_info = 39;
  google.protobuf.Int64Value creator_id = 40;
  google.protobuf.Int64Value batch_id = 41;
  google.protobuf.Int64Value starting_point_id = 42;
  google.protobuf.StringValue market_shortname = 43;
  google.protobuf.StringValue order_protocol_type = 44;
  google.protobuf.Timestamp created_at = 45;
  google.protobuf.Timestamp onsite_estimated_prep_time_updated_at = 46;
  google.protobuf.Timestamp store_order_confirmed_time = 47;
  google.protobuf.BoolValue consumer_pickup_auto_closed = 48;
  google.protobuf.BoolValue is_test = 50;
  google.protobuf.Timestamp dasher_arriving_at_store_time = 51;
  google.protobuf.Timestamp dasher_arriving_at_consumer_time = 52;
  google.protobuf.Timestamp updated_at = 53;
  google.protobuf.Timestamp order_ready_time = 54;
  google.protobuf.BoolValue is_depot = 55;
  google.protobuf.Int32Value fee = 56;
  google.protobuf.StringValue delivery_uuid = 57;
  google.protobuf.Timestamp dasher_wait_until = 58;
  google.protobuf.BoolValue is_route_based_delivery = 59;
  google.protobuf.StringValue idempotency_key = 60;
  google.protobuf.BoolValue is_group_cart_delivery = 61;
  google.protobuf.Int64Value market_id = 62;
  google.protobuf.BoolValue is_preassignable = 63;
  google.protobuf.Int32Value min_age_requirement = 64;
  google.protobuf.BoolValue is_preassign = 65;
  date.Date active_date = 66;
  google.protobuf.StringValue dasher_notes = 67;
  reserved 68;
  google.protobuf.Timestamp internally_calculated_pickup_time = 69;
  google.protobuf.Timestamp internally_calculated_delivery_time = 70;
  reserved 71;
  AlcoholIdvFlow alcohol_idv_flow = 72;
  google.protobuf.StringValue serviceable_vehicle_types = 73;
  google.protobuf.BoolValue should_excuse_unassign = 74;
  google.protobuf.BoolValue should_escalate_when_cx_unavailable = 75;
  google.protobuf.BoolValue should_ignore_unassign_after_pickup = 76;
  google.protobuf.BoolValue should_require_return_check_in = 77;
  google.protobuf.StringValue fulfillment_intent_id = 78;
  repeated task_service.v2.ReattemptReturnStateInfo reattempt_return_history = 79;
}

message DeliveryResponseForCreationV2 {
  DeliveryResponse deliveryResponse = 1;
  eta_prediction.ETAPredictionResponseV2 etaPredictionResponse = 2;
}

enum AlcoholIdvFlow {
  NON_PERSONA_IDV_FLOW = 0;
  PERSONA_IDV_FLOW = 1;
}

message CreateDeliveryResponse {
  google.protobuf.BoolValue is_created = 1;
  DeliveryResponse response = 2;
}

message CreateDeliveryV2Response {
  google.protobuf.BoolValue is_created = 1;
  DeliveryResponseForCreationV2 response = 2;
}

message GetDeliveriesByIdsRequest {
  repeated int64 deliveryIds = 1;
  int32 limit = 2;
}

message GetDeliveriesByIdsResponse {
  map<int64, DeliveryResponse> deliveries = 1;
}

message DasherConfirmDeliveriesRequest {
  repeated DasherConfirmDeliveryRequest batchRequests = 1;
}

message DasherConfirmDeliveriesResponse {
  map<int64, DasherConfirmDeliveryResponse> batchResponses = 1;
}

message DasherConfirmDeliveryRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp internally_calculated_pickup_time = 2;
  google.protobuf.Timestamp internally_calculated_delivery_time = 3;
}

message DasherConfirmDeliveryResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_confirmed_delivery_time = 2;
  google.protobuf.Timestamp internally_calculated_pickup_time = 3;
  google.protobuf.Timestamp internally_calculated_delivery_time = 4;
  google.protobuf.StringValue delivery_uuid = 5;
  google.protobuf.Timestamp dasher_confirmed_at_store_time = 6;
}

message DasherConfirmAtStoreRequest {
  int64 delivery_id = 1;
}

message DasherConfirmAtStoreResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_confirmed_at_store_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DasherConfirmAtConsumerRequest {
  int64 delivery_id = 1;
}

message DasherConfirmAtConsumerResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_confirmed_at_consumer_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DasherArrivingAtStoreRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_arriving_at_store_time = 2;
}

message DasherArrivingAtStoreResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_arriving_at_store_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DasherArrivingAtConsumerRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_arriving_at_consumer_time = 2;
}

message DasherArrivingAtConsumerResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_arriving_at_consumer_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DasherLeavingStoreRequest {
  google.protobuf.StringValue delivery_uuid = 1;
}

message DasherLeavingStoreResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_leaving_store_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DeliveryPickUpRequest {
  int64 delivery_id = 1;
}

message DeliveryPickUpResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp actual_pickup_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
  google.protobuf.Timestamp internally_calculated_pickup_time = 4;
  google.protobuf.Timestamp internally_calculated_delivery_time = 5;
}

message StoreDasherApproachingCustomerTimeRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Timestamp dasher_approaching_customer_time = 2;
}

message StoreDasherApproachingCustomerWideTimeRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Timestamp dasher_approaching_customer_wide_time = 2;
}

message GetDasherProximityInfoRequest {
  google.protobuf.StringValue delivery_uuid = 1;
}

message GetDasherProximityInfoResponse {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Timestamp dasher_approaching_customer_wide_time = 2;
  google.protobuf.Timestamp dasher_approaching_customer_time = 3;
}

message DeliveryDropOffRequest {
  int64 delivery_id = 1;
  google.protobuf.StringValue delivery_location = 2;
  google.protobuf.StringValue delivery_location_description = 3;
  bool is_abandon = 4;
  google.protobuf.DoubleValue dropoff_lat = 5;
  google.protobuf.DoubleValue dropoff_lng = 6;
}

message DeliveryDropOffResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp actual_delivery_time = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message DeliveryAbandonRequest {
  int64 delivery_id = 1;
  int64 dasher_id = 2;
  google.protobuf.StringValue reason = 3;
  google.protobuf.StringValue comment = 4;
}

message GetDeliveryAbandonRequest {
  int64 delivery_id = 1;
}

message GetDeliveryAbandonResponse {
  int64 delivery_id = 1;
  int64 dasher_id = 2;
  google.protobuf.Timestamp abandoned_at = 3;
  google.protobuf.StringValue abandoned_reason = 4;
  google.protobuf.StringValue abandoned_comment = 5;
}

message DeliveryAbandonResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp abandoned_at = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message RevertDeliveryDropOffRequest {
  int64 delivery_id = 1;
}

message RevertDeliveryDropOffResponse {
  int64 delivery_id = 1;
}

message RevertDeliveryPickupRequest {
  int64 delivery_id = 1;
}

message RevertDeliveryPickupResponse {
  int64 delivery_id = 1;
}

message CreateDeliveryFromOrderCartRequest {
  int64 order_cart_id = 1;
  google.protobuf.Timestamp quoted_delivery_time = 2;
  bool is_asap = 3;
  int64 delivery_fee = 4;
  bool is_consumer_pickup = 5;
  string platform_details = 6;
  string partner_source = 7;
  bool is_curbside_dropoff = 8;
  bool dry_run = 9;
  google.protobuf.Timestamp scheduled_delivery_time = 10;
  bool is_shop_and_deliver = 11;
}

message CreateDeliveryFromOrderCartResponse {
  int64 delivery_id = 1;
  google.protobuf.StringValue delivery_uuid = 2;
  google.protobuf.StringValue create_delivery_request = 3;
}

message RescheduleDeliveryRequest {
  string delivery_id = 1;
  google.protobuf.Timestamp quoted_delivery_time = 2;
  google.protobuf.Timestamp delivery_pickup_time = 3;
  bool tzaware = 4;
}

message ActionResponse {
  bool success = 1;
}

message CancelDeliveryRequestV2 {
  google.protobuf.Int64Value delivery_id = 1;
}

message CancelDeliveryRequest {
  int64 id = 1;
  int64 delivery_id = 6;
  bool refund = 2;
  string event_category_name = 3;
  string consumer_explanation = 4;
  bool create_issue = 5;
  google.protobuf.Int64Value created_by_id = 7;
  google.protobuf.Int32Value cancel_reason_category_id = 8;
  string cancellation_reason_code = 9;

  google.protobuf.BoolValue is_from_order_service = 100;
}

message UpdateBatchIdRequest {
  int64 delivery_id = 1;
  google.protobuf.Int64Value batch_id = 2;
}

message UpdateBatchIdResponse {
  int64 delivery_id = 1;
  google.protobuf.Int64Value batch_id = 2;
  google.protobuf.Timestamp updated_at = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateShiftIdRequest {
  int64 delivery_id = 1;
  google.protobuf.Int64Value shift_id = 2;
}

message UpdateShiftIdResponse {
  int64 delivery_id = 1;
  google.protobuf.Int64Value shift_id = 2;
  google.protobuf.Timestamp updated_at = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateDeliveryAudienceInfoRequest {
  // Updatable fields into DeliveryAudienceInfo
  message UpdateFields {
    Recipient recipient = 1;
    Business business = 2;
    DropoffDetails dropoff_details = 3;
    DeliveryEntityData delivery_entity_data = 4;
  }

  // Recipient refers to the consumer to which the delivery would be dropped off at
  message Recipient {
    google.protobuf.StringValue first_name = 1;
    google.protobuf.StringValue last_name = 2;
    google.protobuf.StringValue phone_number = 3;
    // Not yet supported; if this needs support, remove comment and add the support in the implementation
    google.protobuf.StringValue email = 4;
  }

  // Business here refers to the merchant's business
  message Business {
    google.protobuf.StringValue business_name = 1;
  }

  message DropoffDetails {
    // Instructions for dropoff aka dasher instructions
    google.protobuf.StringValue dropoff_instructions = 1;
    // Dropoff address to update
    UpdatableAddress address = 2;
    // entry code for dropoff
    google.protobuf.StringValue entry_code = 3;
    // parking instructions for dropoff
    google.protobuf.StringValue parking_instructions = 4;
    // boolean value if the address is commercial
    google.protobuf.BoolValue is_commercial = 5;
    // boolean value if the address is invalid secondary
    google.protobuf.BoolValue is_invalid_secondary = 6;
    // boolean value if the address is missing secondary
    google.protobuf.BoolValue is_missing_secondary = 7;
    // boolean value if the address location is overridden
    google.protobuf.BoolValue is_location_overridden = 8;
    //Dasher parking details
    DasherParkingDetails dasher_parking_details = 9;
    // Dropoff preferences
    repeated DropOffPreference dropoff_preferences = 10;
    // Location preference
    LocationPreference location_preference = 11;
  }

  // Dropoff preferences
  message DropOffPreference {
    google.protobuf.StringValue instructions = 1;
    google.protobuf.StringValue option_id = 2;
    google.protobuf.BoolValue is_default = 3;
  }

  //Parking details for dasher to update
  message DasherParkingDetails {
    google.protobuf.StringValue prompt_message = 1;
    google.protobuf.StringValue prompt_input_text = 2;
    google.protobuf.StringValue show_prompt = 3;
    google.protobuf.StringValue prompt_input_hint = 4;
    google.protobuf.StringValue promp_title = 5;
  }

  // Address to update, all fields required to enforce address consistency during updates
  message UpdatableAddress {
    int64 id = 1;
    string street = 2;
    string city = 3;
    string state = 4;
    string zip_code = 5;
    string subpremise = 6;
    string printable_address = 7;
    google.protobuf.DoubleValue lat = 8;
    google.protobuf.DoubleValue lng = 9;
    int64 consumer_address_link_id = 10;
    google.protobuf.DoubleValue manual_lat = 11;
    google.protobuf.DoubleValue manual_lng = 12;
    google.protobuf.StringValue building_name = 13;
    google.protobuf.StringValue google_place_id = 14;
    CountryInfo country_info = 15;
    google.protobuf.StringValue source_place_id = 16;
    google.protobuf.DoubleValue navigation_lat = 17;
    google.protobuf.DoubleValue navigation_lng = 18;
    repeated google.protobuf.StringValue formatted_address_segmented_non_user_editable_fields = 19;
  }

  DeliveryIdentifier delivery_identifier = 1;
  UpdateFields update_fields = 2;

  // Country info related to DeliveryAddress
  message CountryInfo {
    google.protobuf.StringValue country_name = 1;
    google.protobuf.StringValue country_short_name = 2;
    google.protobuf.BoolValue allows_pre_tipping = 3;
    google.protobuf.BoolValue allows_post_tipping = 4;
  }
}

message UpdateDeliveryAudienceInfoResponse {
  message Error {
    message FieldError {
      google.protobuf.StringValue field = 1;
      google.protobuf.StringValue input_value = 2;
      google.protobuf.StringValue message = 3;
    }

    enum ErrorCode {
      UNKNOWN_ERROR = 0;
      MISSING_DELIVERY_IDENTIFIER = 1;
      EXCEPTION_CAUGHT = 2;
      BAD_REQUEST = 3;
      INVALID_DELIVERY_ID = 4;
      INVALID_DELIVERY_UUID = 5;
      MISSING_UPDATE_FIELDS = 6;
    }

    ErrorCode error_code = 1;
    google.protobuf.StringValue message = 2;
    FieldError field_error = 3;
  }

  Error error = 1;
  DeliveryIdentifier delivery_identifier = 2;
  google.protobuf.Timestamp updated_at = 3;
}

message UpdateDeliveryOrderProtocolTypeRequest {
  int64 delivery_id = 1;
  google.protobuf.StringValue order_protocol_type = 2;
}

message UpdateDeliveryOrderProtocolTypeResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.StringValue order_protocol_type = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateDasherWaitUntilRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_wait_until = 2;
}

message UpdateDasherWaitUntilResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp dasher_wait_until = 2;
  google.protobuf.Timestamp updated_at = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateCustomerUnavailableEscalatedAtRequest {
  reserved 1;
  google.protobuf.Timestamp customer_unavailable_escalated_at = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message UpdateOrderConfirmedTimeAndPrepTimeRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp store_order_confirmed_time = 3;
  google.protobuf.Timestamp estimate_store_prep_time = 4;
  int64 onsite_estimated_prep_time = 5;
  google.protobuf.Timestamp onsite_estimated_prep_time_updated_at = 6;
}

message UpdateOrderConfirmedTimeAndPrepTimeResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp store_order_confirmed_time = 3;
  google.protobuf.Timestamp estimated_store_prep_time = 4;
  int64 onsite_estimated_prep_time = 5;
  google.protobuf.Timestamp onsite_estimated_prep_time_updated_at = 6;
  google.protobuf.StringValue delivery_uuid = 7;
}

message UpdateOrderConfirmedTimeRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp store_order_confirmed_time = 2;
  google.protobuf.Timestamp estimated_store_prep_time = 3;
}

message UpdateOrderConfirmedTimeResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp store_order_confirmed_time = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateOrderReadyTimeRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp order_ready_time = 2;
}

message UpdateOrderReadyTimeResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp order_ready_time = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateOrderReadyTimeInBulkRequest {
  repeated int64 delivery_ids = 1;
  google.protobuf.Timestamp order_ready_time = 2;
}

message UpdateOrderReadyTimeInBulkResponse {
  repeated int64 delivery_ids = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp order_ready_time = 3;
}

message UpdateShouldBeManuallyAssignedRequest {
  int64 delivery_id = 1;
  bool should_be_manually_assigned = 2;
}

message UpdateShouldBeManuallyAssignedResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  bool should_be_manually_assigned = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message UpdateDeliveryToPickupRequest {
  google.protobuf.StringValue delivery_uuid = 1;
}

message UpdateDeliveryToPickupResponse {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.BoolValue is_consumer_pickup = 2;
  google.protobuf.Timestamp updated_at = 3;

  enum Status {
    STATUS_UNKNOWN = 0;
    STATUS_SUCCESS = 1;
    STATUS_FAILURE = 2;
  }
  Status status = 4;
  // Failure reasons like already_assigned
  google.protobuf.StringValue error_type = 5;
}

message UpdateDeliveryIsDepotRequest {
  int64 delivery_id = 1;
  bool is_depot = 2;
}

message UpdateDeliveryIsDepotResponse {
  int64 delivery_id = 1;
  bool is_depot = 2;
  google.protobuf.Timestamp updated_at = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message CloseDeliveryRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp actual_pickup_time = 2;
  google.protobuf.Timestamp actual_delivery_time = 3;
}

message CloseDeliveryResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp actual_pickup_time = 3;
  google.protobuf.Timestamp actual_delivery_time = 4;
  bool consumer_pickup_auto_closed = 5;
  google.protobuf.StringValue delivery_uuid = 6;
}

message CloseMerchantFulfilledDeliveryRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp actual_pickup_time = 2;
  google.protobuf.Timestamp actual_delivery_time = 3;
}

message CloseMerchantFulfilledDeliveryResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp actual_pickup_time = 3;
  google.protobuf.Timestamp actual_delivery_time = 4;
  bool consumer_pickup_auto_closed = 5;
  google.protobuf.StringValue delivery_uuid = 6;
}

message ConsumerPickedUpRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp actual_pickup_time = 2;
  google.protobuf.Timestamp actual_delivery_time = 3;
  bool consumer_pickup_auto_closed = 4;
}

message ConsumerPickedUpResponse {
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.Timestamp actual_pickup_time = 3;
  google.protobuf.Timestamp actual_delivery_time = 4;
  bool consumer_pickup_auto_closed = 5;
  google.protobuf.StringValue delivery_uuid = 6;
}

message Address {
  int64 id = 1;
  string street = 2;
  string city = 3;
  string state = 4;
  string zip_code = 5;
  string subpremise = 6;
  string printable_address = 7;
  google.protobuf.DoubleValue lat = 8;
  google.protobuf.DoubleValue lng = 9;
  google.protobuf.StringValue google_place_id = 10;
  google.protobuf.StringValue source_place_id = 11;
  google.protobuf.DoubleValue navigation_lat = 12;
  google.protobuf.DoubleValue navigation_lng = 13;
  repeated google.protobuf.StringValue formatted_address_segmented_non_user_editable_fields = 14;
}

message DeliveryAddress {
  Address address = 1;
  int64 consumer_address_link_id = 2;
  google.protobuf.StringValue dasher_instructions = 3;
  google.protobuf.StringValue entry_code = 4;
  google.protobuf.StringValue parking_instructions = 5;
  google.protobuf.BoolValue is_commercial = 6;
  google.protobuf.BoolValue is_invalid_secondary = 7;
  google.protobuf.BoolValue is_missing_secondary = 8;
  DasherParkingDetails dasher_parking_details = 9;
  google.protobuf.DoubleValue manual_lat = 10;
  google.protobuf.DoubleValue manual_lng = 11;
  google.protobuf.BoolValue is_location_overriden = 12;
  google.protobuf.StringValue building_name = 13;
  repeated DropOffPreference dropoff_preferences = 14;
  CountryInfo country_info = 15;
  LocationPreference location_preference = 16;
}

message DropOffPreference {
  google.protobuf.StringValue instructions = 1;
  google.protobuf.StringValue option_id = 2;
  google.protobuf.BoolValue is_default = 3;
}

// LocationPreference is the preference a Cx can select for where they would like their food delivered to
enum LocationPreference {
  // Fallback value for when location preference is not provided
  LOCATION_PREFERENCE_UNSPECIFIED = 0;
  // When Cx specifies they want their food delivered to their hotel room
  LOCATION_PREFERENCE_HOTEL_ROOM = 1;
  // When Cx specifies they want their food delivered to the hotel lobby
  LOCATION_PREFERENCE_HOTEL_LOBBY = 2;
}

// Country info related to DeliveryAddress
message CountryInfo {
  google.protobuf.StringValue country_name = 1;
  google.protobuf.StringValue country_short_name = 2;
  google.protobuf.BoolValue allows_pre_tipping = 3;
  google.protobuf.BoolValue allows_post_tipping = 4;
}

message ActiveTime {
  google.protobuf.Int64Value from_offset = 1;
  google.protobuf.Int64Value to_offset = 2;
}

message DynamicInstruction {
  google.protobuf.StringValue id = 1;
  google.protobuf.StringValue delivery_state = 2;
  google.protobuf.StringValue category = 3;
  google.protobuf.StringValue image_url = 4;
  google.protobuf.StringValue header = 5;
  google.protobuf.StringValue body = 6;
  repeated ActiveTime active_times = 7;
  google.protobuf.Int64Value updated_at = 8;
}

message MxInstruction {
  google.protobuf.StringValue mx_pickup_instructions_for_dasher = 1;
}

message DxPickupInstructionsFromCx {
  google.protobuf.StringValue custom_instructions = 1;
  google.protobuf.BoolValue include_condiments_and_utensils = 2; // will be deprecated
  google.protobuf.BoolValue include_condiments = 3;
  google.protobuf.BoolValue include_utensils = 4;
}

message PickupAddress {
  Address address = 1;
  int64 store_address_link_id = 2;
  google.protobuf.StringValue dasher_instructions = 3;
  google.protobuf.StringValue establishment_name = 4;
  google.protobuf.StringValue parking_tips = 5;
  google.protobuf.StringValue arrived_additional_instructions = 6;
  google.protobuf.StringValue arrived_instructions_image_url = 7;
  google.protobuf.StringValue arriving_additional_instructions = 8;
  google.protobuf.StringValue arriving_instructions_image_url = 9;
  DasherParkingDetails dasher_parking_details = 10;
  repeated DynamicInstruction dynamic_dx_pickup_instructions = 11;
  MxInstruction mx_pickup_instructions = 12;
  DxPickupInstructionsFromCx dx_pickup_instructions_from_cx = 13;
}

message DasherParkingDetails {
  google.protobuf.StringValue prompt_message = 1;
  google.protobuf.StringValue prompt_input_text = 2;
  google.protobuf.StringValue show_prompt = 3;
  google.protobuf.StringValue prompt_input_hint = 4;
  google.protobuf.StringValue prompt_title = 5;
}

message DeliveryAudienceInfoResponse {
  int64 delivery_id = 1;
  string country_shortname = 2;
  int64 store_id = 3;
  string store_name = 4;
  string store_timezone = 5;
  repeated string store_catering_contact_emails = 6;
  string store_notifications_phone_number = 7;
  int64 business_id = 8;
  string business_name = 9;
  int64 recipient_consumer_id = 10;
  int64 recipient_user_id = 11;
  string recipient_phone_number = 12;
  string recipient_first_name = 13;
  string recipient_last_name = 14;
  string recipient_email = 30;
  bool recipient_receives_text_notification = 15;
  DeliveryAddress delivery_address = 17;
  PickupAddress pickup_address = 18;
  google.protobuf.StringValue vehicle_type_name = 19;
  google.protobuf.Int64Value vehicle_id = 20;
  google.protobuf.StringValue vehicle_make = 21;
  google.protobuf.StringValue vehicle_model = 22;
  google.protobuf.StringValue vehicle_year = 23;
  google.protobuf.Int64Value dasher_id = 24;
  google.protobuf.StringValue dasher_first_name = 25;
  google.protobuf.StringValue dasher_last_name = 26;
  google.protobuf.StringValue dasher_phone_number = 27;
  google.protobuf.Int64Value dasher_user_id = 28;
  google.protobuf.StringValue delivery_uuid = 29;
  google.protobuf.StringValue starting_point_name = 31;
  bool is_redacted = 32;
  google.protobuf.StringValue vehicle_color = 33;
  google.protobuf.StringValue store_cover_img_url = 34;
  google.protobuf.StringValue store_business_cover_img_url = 35;
  google.protobuf.Int32Value store_special_instructions_max_length = 36;
  google.protobuf.StringValue store_business_description = 37;
  google.protobuf.StringValue store_address_country = 38;
  google.protobuf.BoolValue store_is_active = 39;
  google.protobuf.BoolValue should_show_store_logo = 40;
  google.protobuf.StringValue parking_spot = 41;
  google.protobuf.Int64Value district_id = 42;
  google.protobuf.StringValue state = 43;
  google.protobuf.Int64Value business_vertical_id = 44;
  repeated DeliveryEntityData deliveryEntityData = 45;
  AccessibilityRequirements accessibility_requirements = 46;
  google.protobuf.StringValue dasher_preferred_name = 47;
}

message AssignDeliveryRequest {
  int64 delivery_id = 1;
  int64 shift_id = 2;
  google.protobuf.Timestamp assigned_time = 3;
  bool manually_assigned = 4;
  bool allow_early_assignment = 5;
  google.protobuf.Int64Value delivery_package_id = 6;
}

message AssignDeliveryResponse {
  // ensure that delivery_state_change::DasherAssignedDeliveryEvent's fields mirror AssignDeliveryResponse
  int64 delivery_id = 1;
  int64 shift_id = 2;
  google.protobuf.Timestamp assigned_time = 3;
  bool manually_assigned = 4;
  bool allow_early_assignment = 5;
  int64 urgent_cutoff = 6;
  google.protobuf.Timestamp updated_at = 7;
  google.protobuf.StringValue delivery_uuid = 8;
  google.protobuf.Int64Value delivery_package_id = 9;
}

message UpdateOutOfStockStatusRequest {
  // Delivery UUID
  string delivery_uuid = 1;
  // Items to update
  repeated OutOfStockItemStatus item_statuses = 2;
}

message PublishDeliveryLifecycleEventsRequest {
  // Delivery IDs
  repeated int64 delivery_ids = 1;
  // DLC event type
  string event_type = 2;
}

message OutOfStockItemStatus {
  // Order Item ID
  int64 order_item_id = 1;
  // OOS Action
  OutOfStockStatus oos_status = 2;
}

message UpdateOutOfStockStatusResponse {
  // Delivery UUID
  string delivery_uuid = 1;
  // OrderItems
  repeated DeliveryOrderItem items = 2;
}

message UpdateDeliveryOrderItemsRequest {
  // Delivery ID
  int64 delivery_id = 1;
  // Updated items
  repeated DeliveryOrderItem order_items = 2;
}

message UpdateDeliveryOrderItemsResponse {
  // Delivery ID
  int64 delivery_id = 1;
  // Items to update
  repeated DeliveryOrderItem order_items = 2;
}

// Response from producing delivery state change event
message PublishDeliveryLifecycleEventsResponse {}

message DeliveryOrderItem {
  reserved 12, 13;
  reserved "weight_gm", "dimension_mm";
  string name = 1;
  string description = 2;
  int64 quantity = 3;
  google.protobuf.StringValue bundle_key = 4;
  bool is_alcohol = 5;
  // item id in dimension_menu_item
  google.protobuf.Int64Value item_id = 6;
  // order_item_id in maindb_order_item
  google.protobuf.Int64Value order_item_id = 7;
  common.restriction_rules.v1.RestrictionInfoWRules restriction_info_w_rules = 8;
  google.protobuf.StringValue merchant_supplied_id = 9;
  OutOfStockStatus oos_status = 10;
  google.protobuf.StringValue image_url = 11;
  // product of per item weight * quantity
  google.protobuf.Int32Value total_weight_gm = 14;
  google.protobuf.Int32Value max_dimension_mm = 15;
  common.ContinuousQuantityInfo continuous_quantity_info = 16;
  google.protobuf.StringValue item_description_for_dasher = 17;
  // per item volume
  google.protobuf.DoubleValue volume_cubic_meter = 18;
  // per item dimensions
  Dimensions dimensions = 19;
  // Navigational L1-L3 categories
  NavigationalInfo navigational_info = 20;
  // L1-L4 taxonomy info
  ProductCategoryInfo product_category_info = 21;
}

message Dimensions {
  google.protobuf.DoubleValue length_m = 1;
  google.protobuf.DoubleValue width_m = 2;
  google.protobuf.DoubleValue height_m = 3;
}

message DeliveryOrderInfoRequest {
  google.protobuf.Int64Value subtotal = 1;
  google.protobuf.Int32Value item_count = 2;
  repeated DeliveryOrderItem items = 3;
  bool contains_alcohol = 4;
  google.protobuf.Int32Value min_age_requirement = 5;
  google.protobuf.BoolValue auto_release_enabled = 6;
  google.protobuf.DoubleValue auto_release_distance = 7;
  google.protobuf.BoolValue requires_payment_card = 8;
  google.protobuf.BoolValue is_contactless_delivery = 10;
  google.protobuf.StringValue experience = 11;
  google.protobuf.Int32Value num_distinct_items = 12;
  google.protobuf.Int32Value min_original_item_price = 13;
  google.protobuf.Int32Value max_original_item_price = 14;
  DasherAcceptModalBadgeType accept_modal_badge_type = 15;
  google.protobuf.StringValue accept_modal_additional_text = 16;
  common.AORProtocol auto_release_protocol = 18;
  google.protobuf.BoolValue is_first_order = 19;
  repeated ContentCategory order_contains = 20;
  OrderConfig order_config = 21;
  google.protobuf.FloatValue composite_score = 22;
  order.CancellationReorderInfo cancellation_reorder_info = 23;
}

enum OutOfStockStatus {
  // Default
  UNSPECIFIED = 0;
  // Item is unavailable
  OUT_OF_STOCK = 1;
  // Item is substituted
  SUBSTITUTED = 2;
}

message DeliveryOrderInfoResponse {
  // next available 29
  reserved 2, 3, 9, 10, 13;
  int64 delivery_id = 1;
  int64 subtotal = 4;
  int64 item_count = 5;
  repeated DeliveryOrderItem items = 6;
  bool contains_alcohol = 7;
  int64 min_age_requirement = 8;
  google.protobuf.StringValue delivery_uuid = 11;
  bool auto_release_enabled = 12;
  google.protobuf.DoubleValue auto_release_distance = 17;
  google.protobuf.BoolValue requires_payment_card = 14;
  google.protobuf.BoolValue is_contactless_delivery = 15;
  google.protobuf.StringValue experience = 16;
  DasherAcceptModalBadgeType accept_modal_badge_type = 18;
  google.protobuf.StringValue accept_modal_additional_text = 19;
  int32 num_distinct_items = 20;
  int64 max_original_item_price = 21;
  int64 min_original_item_price = 22;
  common.AORProtocol auto_release_protocol = 24;
  bool is_first_order = 25;
  repeated ContentCategory order_contains = 26;
  OrderConfig order_config = 27;
  google.protobuf.FloatValue composite_score = 28;
  order.CancellationReorderInfo cancellation_reorder_info = 29;
}

enum ContentCategory {
  // contains pharmacy
  PHARMA = 0;
  // contains pizza
  PIZZA = 1;
}

// relevant OrderConfig fields to add to DeliveryOrderInfo
message OrderConfig {
  common.order_config.v1.OrderConfig.PackageOrderType package_order_type = 1;
  common.order_config.v1.OrderConfig.DeliveryOptionType delivery_option_type = 2;
}

message UnassignDeliveryRequest {
  int64 delivery_id = 1;
  google.protobuf.Timestamp unassinged_time = 2;
  google.protobuf.StringValue unassign_reason = 3;
  google.protobuf.BoolValue is_excused = 4;
  google.protobuf.StringValue route_at_unassignment = 5;
  google.protobuf.BoolValue is_unassigned_by_dasher = 6;
}

message UnassignDeliveryResponse {
  // Not returning the same fields as DeliveryStateChange:DasherUnassignedDeliveryEvent
  // because most of the fields are constant for every un-assignment
  int64 delivery_id = 1;
  google.protobuf.Timestamp updated_at = 2;
  google.protobuf.StringValue delivery_uuid = 3;
}

message CreateDeliveryRequest {
  google.protobuf.StringValue idempotency_key = 1;
  google.protobuf.Int64Value cash_on_delivery = 2;
  google.protobuf.StringValue fulfillment_type = 3;
  google.protobuf.Int64Value pickup_address_id = 4;
  google.protobuf.Int64Value delivery_address_id = 5;
  google.protobuf.Timestamp quoted_delivery_time = 6;
  google.protobuf.BoolValue is_asap = 7;
  google.protobuf.BoolValue is_consumer_pickup = 8;
  google.protobuf.Int64Value value_of_contents = 9;
  google.protobuf.BoolValue is_from_store_to_us = 10;
  google.protobuf.StringValue source = 11;
  google.protobuf.BoolValue should_be_manually_assigned = 12;
  google.protobuf.BoolValue signature_required = 13;
  google.protobuf.Int64Value submarket_id = 14;
  google.protobuf.Int64Value parent_delivery_id = 15;
  google.protobuf.Int64Value store_order_cart_id = 16;
  google.protobuf.Int64Value order_cart_id = 17;
  google.protobuf.Int64Value store_id = 18;
  google.protobuf.Int64Value eta_prediction_id = 19;
  google.protobuf.StringValue currency = 20;
  google.protobuf.StringValue google_estimate = 21;
  google.protobuf.Int64Value pre_delivery_tip_amount = 22;
  google.protobuf.StringValue pickup_location_info = 23;
  google.protobuf.StringValue dropoff_location_info = 24;
  google.protobuf.Int64Value creator_id = 25;
  google.protobuf.Int64Value starting_point_id = 26;
  google.protobuf.StringValue market_shortname = 27;
  google.protobuf.StringValue order_protocol_type = 28;
  google.protobuf.Timestamp store_order_confirmed_time = 29;
  google.protobuf.BoolValue is_group_cart_delivery = 30;
  google.protobuf.StringValue partner_source = 31;
  google.protobuf.BoolValue proactive_monitoring_required = 32;
  google.protobuf.BoolValue is_preassignable = 33;
  google.protobuf.BoolValue is_test = 34;
  google.protobuf.Int32Value fee = 35;
  google.protobuf.Int32Value fee_baserate = 36;
  google.protobuf.BoolValue allow_unattended_delivery = 37;
  google.protobuf.BoolValue is_route_based_delivery = 38;
  google.protobuf.Int32Value min_age_required = 39;
  google.protobuf.BoolValue can_be_batched = 40;
  google.protobuf.StringValue serviceable_vehicle_types = 41;
  google.protobuf.StringValue soft_requirements = 42;
  google.protobuf.BoolValue is_depot = 43;
  google.protobuf.BoolValue is_curbside_dropoff = 44;
  google.protobuf.Int64Value marketing_fee = 45;
  google.protobuf.BoolValue is_from_partner_store = 46;
  google.protobuf.Timestamp eta_prediction_updated_at = 47;
  google.protobuf.Int64Value market_id = 48;
  google.protobuf.StringValue market_timezone = 49;
  google.protobuf.BoolValue is_shop_and_deliver = 50;
  DeliveryAssignmentConstraintRequest delivery_assignment_constraint = 51;
  google.protobuf.Int64Value onsite_estimated_prep_time = 54;
  google.protobuf.BoolValue is_for_return = 55;
  google.protobuf.StringValue original_delivery_uuid = 56;
  DeliveryOrderInfoRequest delivery_order_info = 57;
  AudienceInfoRequest delivery_audience_info = 58;
  google.protobuf.Timestamp order_ready_time = 59;
  common.DasherPickupProtocol dasher_pickup_protocol = 60;
  google.protobuf.BoolValue should_notify_dasher_for_pickup = 61;
  DeliveryDasherPayTag delivery_dasher_pay_tag = 62;
  common.AgeRestrictedIdVerificationVendor cx_age_verification = 63;
  google.protobuf.StringValue cx_age_verification_image = 64;
  google.protobuf.StringValue delivery_reference_tag = 65;
  common.AlcoholBehaviorOverride alcohol_behavior_override = 66;
  common.DasherPickupVerifyProtocol dasher_pickup_verify_protocol = 67;
  reserved 52, 53;
  google.protobuf.BoolValue staging_required = 68;
  google.protobuf.StringValue quoted_eta_id = 69;
  google.protobuf.Timestamp quoted_merchant_pickup_time = 70;
  ParentDeliveryInfoV2 parent_delivery_info_v2 = 71;
  common.DasherPickupVerificationInfo dasher_pickup_verification_info = 72;
  google.protobuf.BoolValue should_excuse_unassign = 73;
  google.protobuf.BoolValue should_escalate_when_cx_unavailable = 74;
  google.protobuf.BoolValue should_ignore_unassign_after_pickup = 75;
  google.protobuf.BoolValue should_require_return_check_in = 76;
  google.protobuf.StringValue fulfillment_intent_id = 77;
  OrderFulfillmentMethod order_fulfillment_method = 78;
}

message CreateDeliveryV2Request {
  CreateDeliveryRequest createDeliveryRequest = 1;
  eta_prediction.CreateAndSaveDefaultEtaPredictionRequest etaPredictionRequest = 2;
  google.protobuf.Int64Value delivery_id = 3;
  google.protobuf.StringValue delivery_uuid = 4;
}

message OrderInfoRequest {
  repeated DriveOrderItem order_items = 1;
}

message DriveOrderItem {
  google.protobuf.Int64Value id = 1;
  google.protobuf.StringValue name = 2;
  google.protobuf.StringValue description = 3;
  google.protobuf.StringValue barcode = 4;
  google.protobuf.StringValue scan_status = 5;
  google.protobuf.BoolValue is_damaged = 6;
  google.protobuf.Int32Value quantity = 7;
  google.protobuf.DoubleValue volume = 8;
  google.protobuf.DoubleValue weight = 9;
  google.protobuf.StringValue external_id = 10;
  google.protobuf.Int32Value price = 11; // Price is an int32, where the last 2 digits represent the cents. price = 123 represents 1.23
}

message AudienceInfoRequest {
  reserved 16;
  google.protobuf.StringValue country_shortname = 1;
  google.protobuf.StringValue store_name = 2;
  google.protobuf.StringValue store_timezone = 3;
  google.protobuf.StringValue store_notifications_phone_number = 4;
  google.protobuf.Int64Value business_id = 5;
  google.protobuf.StringValue business_name = 6;
  google.protobuf.Int64Value recipient_consumer_id = 7;
  google.protobuf.Int64Value recipient_user_id = 8;
  google.protobuf.StringValue recipient_phone_number = 9;
  google.protobuf.StringValue recipient_first_name = 10;
  google.protobuf.StringValue recipient_last_name = 11;
  google.protobuf.StringValue recipient_email = 17;
  google.protobuf.BoolValue recipient_receives_text_notification = 12;
  repeated string store_catering_contact_emails = 15;
  DeliveryAddress delivery_address = 18;
  PickupAddress pickup_address = 19;
  google.protobuf.Int64Value store_id = 20;
  google.protobuf.StringValue starting_point_name = 21;
  google.protobuf.StringValue store_cover_img_url = 22;
  google.protobuf.StringValue store_business_cover_img_url = 23;
  google.protobuf.Int32Value store_special_instructions_max_length = 24;
  google.protobuf.StringValue store_business_description = 25;
  google.protobuf.StringValue store_address_country = 26;
  google.protobuf.BoolValue store_is_active = 27;
  google.protobuf.BoolValue should_show_store_logo = 28;
  google.protobuf.Int64Value district_id = 29;
  google.protobuf.StringValue state = 30;
  google.protobuf.Int64Value business_vertical_id = 31;
  AccessibilityRequirements accessibility_requirements = 32;
  repeated DeliveryEntityData delivery_entity_data = 33;
}

message AccessibilityRequirements {
  google.protobuf.BoolValue dropoff_address_has_accessibility_requirements = 1;
  google.protobuf.BoolValue pickup_address_has_accessibility_requirements = 2;
}

message AddressInfoRequest {
  PickupAddress pickup_address = 1;
  DeliveryAddress delivery_address = 2;
}

message DasherAttributePreference {
  common.DasherAttributeType dasher_attribute_type = 1;
  google.protobuf.Int32Value preference_value = 2;
}

message DasherEquipmentPreference {
  common.DasherEquipmentType dasher_equipment_type = 1;
  google.protobuf.Int32Value preference_value = 2;
}

message DasherOnboardingPreference {
  common.DasherOnboardingType dasher_onboarding_type = 1;
  google.protobuf.Int32Value preference_value = 2;
}

message VehicleTypePreference {
  google.protobuf.Int32Value vehicle_type_id = 1;
  google.protobuf.Int32Value preference_value = 2;
}

message DeliveryAssignmentConstraintRequest {
  google.protobuf.BoolValue single_store_batching = 1;
  google.protobuf.Int32Value order_volume = 2;
  google.protobuf.Int32Value max_batch_size = 3;
  google.protobuf.Int32Value max_mins_allowed_on_road = 4;
  google.protobuf.Timestamp pickup_window_start_time = 5;
  google.protobuf.Timestamp pickup_window_end_time = 6;
  google.protobuf.Timestamp delivery_window_start_time = 7;
  google.protobuf.Timestamp delivery_window_end_time = 8;
  repeated int32 preferred_dasher_equipment_ids = 9;
  repeated DasherAttributePreference prefer_dasher_attributes = 10;
  repeated DasherEquipmentPreference prefer_dasher_equipment = 11;
  repeated DasherOnboardingPreference prefer_dasher_onboarding = 12;
  repeated VehicleTypePreference prefer_vehicles = 13;
  google.protobuf.Int32Value tradeoff_asap_cost = 14;
  google.protobuf.Int32Value tradeoff_asap_dasher_wait = 15;
  google.protobuf.StringValue experiment_info = 16; //Json Format
  google.protobuf.StringValue force_batch_uuid = 17;
  google.protobuf.BoolValue ignore_merchant_signals = 18;
  google.protobuf.Int32Value forced_pickup_order_in_package = 19;
  google.protobuf.BoolValue is_dsd = 20;
  google.protobuf.Int64Value business_vertical_id = 21;
  google.protobuf.StringValue static_preferences = 22;
  google.protobuf.BoolValue should_remove_force_batch_uuid = 23;
  ConstraintAttributes constraint_attributes = 24;
  reserved "dashpass_benefits";
  reserved 25;
}

message UpdateDeliveryAssignmentConstraintRequest {
  google.protobuf.BoolValue single_store_batching = 1;
  google.protobuf.Int32Value order_volume = 2;
  google.protobuf.Int32Value max_batch_size = 3;
  google.protobuf.Int32Value max_mins_allowed_on_road = 4;
  google.protobuf.Timestamp pickup_window_start_time = 5;
  google.protobuf.Timestamp pickup_window_end_time = 6;
  google.protobuf.Timestamp delivery_window_start_time = 7;
  google.protobuf.Timestamp delivery_window_end_time = 8;
  repeated int32 preferred_dasher_equipment_ids = 9;
  repeated DasherAttributePreference prefer_dasher_attributes = 10;
  repeated DasherEquipmentPreference prefer_dasher_equipment = 11;
  repeated DasherOnboardingPreference prefer_dasher_onboarding = 12;
  repeated VehicleTypePreference prefer_vehicles = 13;
  google.protobuf.Int32Value tradeoff_asap_cost = 14;
  google.protobuf.Int32Value tradeoff_asap_dasher_wait = 15;
  google.protobuf.StringValue experiment_info = 16; //Json Format
  google.protobuf.Int64Value delivery_id = 17;
  google.protobuf.StringValue force_batch_uuid = 18;
  google.protobuf.BoolValue ignore_merchant_signals = 19;
  google.protobuf.Int32Value forced_pickup_order_in_package = 20;
  google.protobuf.BoolValue is_dsd = 21;
  google.protobuf.Int64Value business_vertical_id = 22;
  google.protobuf.BoolValue should_remove_force_batch_uuid = 23;
  google.protobuf.StringValue static_preferences = 24;
  ConstraintAttributes constraint_attributes = 25;
  reserved "dashpass_benefits";
  reserved 26;
}

message UpdateMerchantTransactionIdRequest {
  int64 delivery_id = 1;
  google.protobuf.Int32Value merchant_transaction_id = 2;
  google.protobuf.Int64Value merchant_transaction_id_long = 3;
}

message UpdateMerchantTransactionIdResponse {
  int64 delivery_id = 1;
  google.protobuf.Int32Value merchant_transaction_id = 2;
  google.protobuf.Timestamp updated_at = 3;
  google.protobuf.StringValue delivery_uuid = 4;
  google.protobuf.Int64Value merchant_transaction_id_long = 5;
}

message GetDeliveriesByMerchantTransactionIdsRequest {
  repeated int64 merchant_transaction_ids = 1;
}

message DeliveryForMerchantFinancialServiceResponse {
  int64 delivery_id = 1;
  string delivery_uuid = 2;
  google.protobuf.StringValue idempotency_key = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
  google.protobuf.Timestamp quoted_delivery_time = 6;
  google.protobuf.Timestamp store_order_confirmed_time = 7;
  google.protobuf.Timestamp actual_pickup_time = 8;
  google.protobuf.Timestamp cancelled_at = 9;

  google.protobuf.Int64Value merchant_transaction_id = 10;
  google.protobuf.Int64Value store_id = 11;
  google.protobuf.Int64Value order_cart_id = 12;
  google.protobuf.Int64Value store_order_cart_id = 13;
  google.protobuf.Int64Value submarket_id = 14;

  bool is_from_store_to_us = 15;
  google.protobuf.StringValue fulfillment_type = 16;
  google.protobuf.StringValue order_protocol_type = 17;
  google.protobuf.Int32Value fee = 18;
  google.protobuf.Int64Value cash_on_delivery = 19;

  google.protobuf.BoolValue is_test = 20;

  google.protobuf.Int32Value min_age_requirement = 21;
  google.protobuf.Timestamp abandoned_at = 22;
}

message GetDeliveriesByMerchantTransactionIdsResponse {
  repeated DeliveryForMerchantFinancialServiceResponse deliveries = 1;
}

enum EntityType {
  CONSUMER = 0;
  BUSINESS = 1;
}

message PreferenceForDasherRequest {
  int64 dasher_id = 1;
  EntityType entity_type = 2;
  int64 entity_id = 3;
}

message PreferenceForDasherResponse {
  EntityType entity_type = 1;
  int64 entity_id = 2;
}

message ListPreferenceForDasherRequest {
  int64 dasher_id = 1;
}

message ListPreferenceForDasherResponse {
  repeated PreferenceForDasherResponse entities = 1;
}

message IsReturnDeliveryRequest {
  string delivery_uuid = 1;
}

message IsReturnDeliveryResponse {
  bool is_return_delivery = 1;
  google.protobuf.StringValue original_delivery_uuid = 2;
}

message HasReturnDeliveryRequest {
  string delivery_uuid = 1;
}

message HasReturnDeliveryResponse {
  bool has_return_delivery = 1;
  google.protobuf.StringValue return_delivery_uuid = 2;
}

message GetDeliveryAssignmentConstraintRequest {
  oneof identifier {
    int64 delivery_id = 1;
    int64 delivery_assignment_constraint_id = 2;
  }
}

message DeliveryAssignmentConstraint {
  google.protobuf.Int64Value id = 1;
  google.protobuf.Int64Value delivery_id = 2;
  google.protobuf.BoolValue single_store_batching = 3;
  google.protobuf.Int32Value order_volume = 4;
  google.protobuf.Int32Value max_batch_size = 5;
  google.protobuf.Int32Value max_mins_allowed_on_road = 6;
  google.protobuf.Timestamp pickup_window_start_time = 7;
  google.protobuf.Timestamp pickup_window_end_time = 8;
  google.protobuf.Timestamp delivery_window_start_time = 9;
  google.protobuf.Timestamp delivery_window_end_time = 10;
  repeated int32 preferred_dasher_equipment_ids = 11;
  repeated DasherAttributePreference prefer_dasher_attributes = 12;
  repeated DasherEquipmentPreference prefer_dasher_equipment = 13;
  repeated DasherOnboardingPreference prefer_dasher_onboarding = 14;
  repeated VehicleTypePreference prefer_vehicles = 15;
  google.protobuf.Int32Value tradeoff_asap_cost = 16;
  google.protobuf.Int32Value tradeoff_asap_dasher_wait = 17;
  google.protobuf.StringValue experiment_info = 18; //Json Format
  google.protobuf.StringValue force_batch_uuid = 19;
  google.protobuf.BoolValue ignore_merchant_signals = 20;
  google.protobuf.Int32Value forced_pickup_order_in_package = 21;
  google.protobuf.BoolValue is_dsd = 22;
  google.protobuf.Int64Value business_vertical_id = 23;
  google.protobuf.StringValue static_preferences = 24;
  ConstraintAttributes constraint_attributes = 25;
  reserved "dashpass_benefits";
  reserved 26;
}

message GetDeliveryAssignmentConstraintResponse {
  DeliveryAssignmentConstraint delivery_assignment_constraint = 1;
}

message UpdateDeliveryMonetaryFieldsRequest {
  oneof identifier {
    google.protobuf.Int64Value delivery_id = 1;
    google.protobuf.StringValue delivery_uuid = 2;
  }
  google.protobuf.Int32Value pre_delivery_tip_amount = 3;
  google.protobuf.Int32Value value_of_contents = 4;
  google.protobuf.Int32Value marketing_fee = 5;
}

message UpdateDeliveryMonetaryFieldsResponse {
  google.protobuf.Int64Value delivery_id = 1;
  google.protobuf.StringValue delivery_uuid = 2;
  google.protobuf.Timestamp updated_at = 3;
}

message UpdateParkingSpotInfoRequest {
  string delivery_uuid = 1;
  string parking_spot = 2;
}

message HasContactlessDasherInstructionsRequest {
  int64 delivery_id = 1;
}

message HasContactlessDasherInstructionsResponse {
  bool has_contactless_dasher_instructions = 1;
}

enum DasherAcceptModalBadgeType {
  UNKNOWN = 0;
  PRIORITY_DELIVERY = 1;
}

message GetDeliveryUuidsByQuotedDeliveryTimeRequest {
  google.protobuf.Int64Value store_id = 1;
  google.protobuf.Timestamp quoted_delivery_time_start = 2;
  google.protobuf.Timestamp quoted_delivery_time_end = 3;
}

message GetDeliveryUuidsByQuotedDeliveryTimeResponse {
  repeated google.protobuf.StringValue delivery_uuid = 2;
}

message GetDeliveriesByQuotedDeliveryTimeRequest {
  google.protobuf.Int64Value store_id = 1;
  google.protobuf.Timestamp quoted_delivery_time_start = 2;
  google.protobuf.Timestamp quoted_delivery_time_end = 3;
}

message GetDeliveriesByQuotedDeliveryTimeResponse {
  repeated DeliveryResponse deliveries = 2;
  // flag to indicate that response was potentially truncated as number of deliveries were equal to or more than limit
  google.protobuf.BoolValue is_truncated = 3;
}

enum DeliveryDasherPayTag {
  TYPE_UNKNOWN = 0;
  DRIVE_SOF = 1;
  CNG_GROCERY = 2;
  CNG_CONVENIENCE = 3;
  MARKETPLACE_EXPRESS = 4;
  DRIVE_DASHER_SHOP_AND_DELIVER = 5;
}

enum DashpassBenefits {
  DASHPASS_BENEFITS_UNSPECIFIED = 0;
  DASHPASS_BENEFITS_TOP_DASHER = 1;
  DASHPASS_BENEFITS_PRIORITY_STATUS = 2;
}

message DeliveryVerificationRequest {
  google.protobuf.StringValue delivery_uuid = 1;
  google.protobuf.Int64Value delivery_id = 2;
  DeliveryVerificationEvent verification_event = 3;
}

message DeliveryVerificationResponse {
  google.protobuf.BoolValue verified = 1;
}

message DeliveryVerificationEvent {
  google.protobuf.StringValue address_id = 1;
  google.protobuf.StringValue photo_url = 2;
  google.protobuf.FloatValue course = 3;
  google.protobuf.FloatValue horizontal_accuracy = 4;
  google.protobuf.FloatValue vertical_accuracy = 5;
  google.protobuf.Timestamp timestamp = 6;
  google.protobuf.DoubleValue photo_submit_lat = 7;
  google.protobuf.DoubleValue photo_submit_lng = 8;
  google.protobuf.DoubleValue camera_open_lat = 9;
  google.protobuf.DoubleValue camera_open_lng = 10;
  google.protobuf.StringValue image_src = 11;
  google.protobuf.StringValue delivery_type = 12;
  google.protobuf.StringValue input_description = 13;
  google.protobuf.StringValue context = 14;
}

message CreateDeliveryWithIdRequest {
  google.protobuf.Int64Value delivery_id = 1;
  google.protobuf.StringValue delivery_uuid = 2;
  CreateDeliveryRequest request_data = 3;
}

message CreateDeliveryV2WithIdRequest {
  google.protobuf.Int64Value delivery_id = 1;
  google.protobuf.StringValue delivery_uuid = 2;
  CreateDeliveryV2Request request_data = 3;
}

message DeliveryEntityData {
  reserved 1, 2;
  reserved "entity_name", "entity_data";
  oneof entity {
    dasher_handoffs_service.entity.v1.DasherHandoffsEntity dasher_handoffs_entity = 3;
    dasher_handoffs_service.entity.v1.DasherNudgeEntity dasher_nudge_entity = 4;
    ProofOfDelivery proof_of_delivery_entity = 5;
  }
}

// data related to proof of delivery
message ProofOfDelivery {
  ProofOfDeliveryType proof_of_delivery_type = 1;
  // more info to store regarding proof of delivery
  map<string, string> details = 2;
}

enum ProofOfDeliveryType {
  NONE = 0;
  PIN_CODE = 1;
  SIGNATURE = 2;
}

message ConstraintAttributes {
  // delay_assignment_signals holds all the dasher assignment delay signals passed from the client for this delivery
  repeated DelayAssignmentSignal delay_assignment_signals = 1;
  // nearbyAsapPadSeconds is used to pad delivery time
  google.protobuf.Int64Value nearbyAsapPadSeconds = 2;
  // isNearby is used to check if the delivery is nearby
  google.protobuf.BoolValue isNearby = 3;
  // dashpass benefits
  DashpassBenefits dashpass_benefits = 4;
}

// The type for dasher delay events sent from frontend
enum DelayAssignmentSignal {
  // When no event is specified for the delay signal.
  DELAY_ASSIGNMENT_SIGNAL_UNSPECIFIED = 0;
  // When Cx creates an order.
  DELAY_ASSIGNMENT_SIGNAL_CREATE_PRIMARY_ORDER = 1;
  // When Cx makes a double dash order.
  DELAY_ASSIGNMENT_SIGNAL_CREATE_DBD_ORDER = 2;
  // When Cx clicks on the bottom sheet card.
  DELAY_ASSIGNMENT_SIGNAL_CLICK_DBD_BOTTOM_SHEET = 3;
  // When Cx clicks on the "Did you forget?" card.
  DELAY_ASSIGNMENT_SIGNAL_CLICK_DYF = 4;
  // When Cx clicks on the "For You".
  DELAY_ASSIGNMENT_SIGNAL_CLICK_FOR_YOU = 5;
  // When Cx clicks on the Category filter.
  DELAY_ASSIGNMENT_SIGNAL_CLICK_CATEGORY_FILTER = 6;
  // When Cx has not interacted with bottom sheet for 90 seconds.
  DELAY_ASSIGNMENT_SIGNAL_NO_CLICK_BOTTOM_SHEET_90S = 7;
  // When Cx loads for the first double dash store.
  DELAY_ASSIGNMENT_SIGNAL_DBD_STORE_PAGE_LOAD_FIRST = 8;
  // When Cx loads for the second double dash store.
  DELAY_ASSIGNMENT_SIGNAL_DBD_STORE_PAGE_LOAD_SECOND = 9;
  // When Cx adds an item to the double dash cart.
  DELAY_ASSIGNMENT_SIGNAL_DBD_ADD_ITEM_TO_CART = 10;
  // When Cx searches on double dash.
  DELAY_ASSIGNMENT_SIGNAL_DBD_SEARCH = 11;
  // When Cx chooses GroceryPro delivery for Cng orders.
  DELAY_ASSIGNMENT_SIGNAL_GROCERY_PRO = 12;
}

// Used to identify the parent delivery in an automatic reorder scenario following a cancellation
message ParentDeliveryInfoV2 {
  ParentDeliveryV2Category parent_delivery_v2_category = 1;
  google.protobuf.Int64Value parent_delivery_id_v2 = 2;
}

enum ParentDeliveryV2Category {
  PARENT_DELIVERY_V2_CATEGORY_UNKNOWN = 0;
  PARENT_DELIVERY_V2_CATEGORY_AUTOMATIC_REORDER = 1;
  PARENT_DELIVERY_V2_CATEGORY_REDELIVERY = 2;
  PARENT_DELIVERY_V2_CATEGORY_ONE_CLICK_REORDER = 3;
}

// L1-L4 taxonomy info
message ProductCategoryInfo {
  // L1 Product Category info
  ProductCategory product_category_l1 = 1;
  // L2 Product category info
  ProductCategory product_category_l2 = 2;
  // (optional) L3 Product category info
  ProductCategory product_category_l3 = 3;
  // (optional) L4 Product category info
  ProductCategory product_category_l4 = 4;
}

// Product category id, name and display name
message ProductCategory {
  // id of product category taxonomy
  int64 id = 1;
  // product category name
  string name = 2;
  // product category display name
  string display_name = 3;
}

// Navigational L1-L3 categories
message NavigationalInfo {
  // root category id
  string category1_id = 1;
  // root category name
  string category1_name = 2;
  // sub category id
  string category2_id = 3;
  // sub category name
  string category2_name = 4;
  // 3rd layer navigation category id
  string category3_id = 5;
  // 3rd layer navigation category name
  string category3_name = 6;
  // 3rd layer navigation category short name
  string category3_short_name = 7;
}

message GetStaticLiteDeliveryRequest {
  int64 delivery_id = 1;
  string delivery_uuid = 2;
}

message GetStaticLiteDeliveryResponse {
  int64 delivery_id = 1;
  string delivery_uuid = 2;
  int64 business_vertical_id = 3;
  int64 store_id = 4;
  string store_timezone = 5;
  bool is_return_delivery = 6;
  string recipient_first_name = 7;
  string recipient_last_name = 8;
  // pickup address object is not guaranteed to be static during the delivery lifecycle
  // and if changes are made to the pickup address, the changes will not be reflected in this object
  Address pickup_address = 9;
  string store_name = 10;
  // delivery address object is not guaranteed to be static during the delivery lifecycle
  // and if changes are made to the delivery address, the changes will not be reflected in this object
  Address delivery_address = 11;
}

// Determines the method of fulfillment needed to complete the order.
// This enum allows future fulfillment methods to be added without modifying the CreateDeliveryRequest.
enum OrderFulfillmentMethod {
  ORDER_FULFILLMENT_METHOD_UNSPECIFIED = 0;
  ORDER_FULFILLMENT_METHOD_SHOP_DELIVER = 1;
  ORDER_FULFILLMENT_METHOD_SHOP_HANDOFF = 2;
  ORDER_FULFILLMENT_METHOD_SHOP_STAGE = 3;
}
