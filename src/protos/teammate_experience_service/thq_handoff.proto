syntax = "proto3";
package teammate_experience_service.api.v1;

import "common/service_client_config.proto";
import "google/protobuf/wrappers.proto";

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.tes.api.v1";

// THQ handoff service provides case summaries that are help
// teammates start working on case immediately and improve their case handle time.
// Design doc: https://docs.google.com/document/d/1tCmELc9UoDZ0SJBHQESxQVAZg1i-xj7DlH7c4zzWdZU/edit#heading=h.jujyf53ovqoy
// Known Callers - admin-gateway for showing summaries in THQ.
// Dependency - Argil and OpenAI Chat GPT.
// PRD: https://docs.google.com/document/d/1nVwg5fwGUfKqOSdjABP4kkA8y_jXMyalTKZJ8BCys7U/edit
service ThqHandoffService {
  // Defaults for hermes clients. This service makes call to hosted LLMs which are sometimes slower.
  // for reference: https://github.com/doordash/dd-util-java/wiki/Hermes#hermes-default-behavior
  option (service_client.client_config).service_name = "teammate-experience-service";
  option (service_client.client_config).retry_config.max_attempts = 3;
  option (service_client.client_config).response_attempt_timeout_millis = 30000;
  option (service_client.client_config).circuit_breaker_config.failure_rate_threshold = 1.0;
  option (service_client.client_config).retry_config.initial_wait_millis = 500;
  option (service_client.client_config).retry_config.wait_multiplier = 2.0;

  // Call to provide summarized insights for teammate from chat transcripts, timeline, etc.
  rpc GetHandoffSummary(GetHandoffSummaryRequest) returns (GetHandoffSummaryResponse);
}

// Request for THQ Handoff summary service.
message GetHandoffSummaryRequest {
  // Parameters for the model.
  repeated InputParameter parameters = 1;

  // Type of request. (e.g "title", "summary", "sentiment", "actions", etc)
  google.protobuf.StringValue request_type = 2;
}

// Input parameter for THQ Handoff summary requests.
message InputParameter {
  // Key for input parameter. e.g
  // "chatMessages" - For chat transcripts.
  // "timeline" - For timeline summary.
  google.protobuf.StringValue parameter_name = 1;

  // Value of the parameter (Json encoded if object).
  google.protobuf.StringValue parameter_balue = 2;
}

// Response from THQ Handoff summary service.
message GetHandoffSummaryResponse {
  // The name of the model used for generating insights.
  google.protobuf.StringValue model_name = 1;

  // The version of the model used for generating insights.
  google.protobuf.StringValue model_version = 2;

  // The id of the inference request if one was specified in input. Otherwise will be random UUID
  google.protobuf.StringValue request_id = 3;

  // Insights generated by model.
  repeated Insights insights = 4;
}

// This stores the result generated by parsing Argil / ChatGPT responses.
message Insights {
  // The type of the insigts being generated. (e.g "title", "summary", "sentiment", "actions", etc)
  // Based on the insight type, we can decode the insights json.
  google.protobuf.StringValue insights_type = 1;

  // Json encoded string for storing insights generated. The Json is decoded in the gateway.
  google.protobuf.StringValue insights_json = 2;
}
