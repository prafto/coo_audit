syntax = "proto3";

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

package doordash.retail.consumer.v1;

option java_multiple_files = true;
option java_generic_services = true;
option java_package = "com.doordash.rpc.retail.search_query_override";

// The query override search tool in retail service.
service SearchQueryOverrideService {
  // Adding or updating a query override in the database.
  rpc CreateQueryOverride(CreateQueryOverrideRequest) returns (CreateQueryOverrideResponse);
  // Getting an active query override in the database.
  rpc GetQueryOverride(GetQueryOverrideRequest) returns (GetQueryOverrideResponse);
}

// Request to create/update a query override.
message CreateQueryOverrideRequest {
   // Business id of the business the query override is for.
   int64 business_id = 1;
   // The original query used in search.
   string original_query = 2;
   // The query that is used to replace the original query.
   string override_query = 3;
   // The tool is currently only for "grocery" vertical, but may extend in the future.
   Verticals verticals = 4;
   // The specific store that the query override corresponds to.
   google.protobuf.Int64Value store_id = 5;
   // The id of the operator who creates this override mapping.
   google.protobuf.StringValue created_by = 6;
   // The id of the operator who updates this override mapping.
   google.protobuf.StringValue updated_by = 7;
}

// Response that contains details about the query override that was created/updated.
message CreateQueryOverrideResponse {
   // On success, return the override_query that is created/updated.
   message Success {
      // The override query that is created/updated.
      OverrideQuery override_query = 1;
   }
   // The create/update is a success.
   Success success = 1;
}

// Request to get an active query override.
message GetQueryOverrideRequest {
   // The business id of the query overrides we are searching for.
   google.protobuf.Int64Value business_id = 1;
   // The store id of the query overrides we are searching for.
   google.protobuf.Int64Value store_id = 2;
   // The original query of the query overrides we are searching for.
   google.protobuf.StringValue original_query = 3;
   // The status of the query overrides we are searching for.
   Status status = 4;
}

// Response to return an active query override.
message GetQueryOverrideResponse {
   // On success, return the override_query that is found.
    message Success {
       // The override queries that are found.
       repeated OverrideQuery override_queries = 1;
    }
   // The get is a success.
    Success success = 1;
}

// This is the object returned to the user that shows the query that was created/updated.
message OverrideQuery {
   // Unique identifier auto-generated by database.
   string id = 1;
   // Business id of the business the query override is for.
   int64 business_id = 2;
   // The original query used in search.
   string original_query = 3;
   // The query that is used to replace the original query.
   string override_query = 4;
   // The tool is currently only for "grocery" vertical, but may extend in the future.
   Verticals verticals = 5;
   // The specific store that the query override corresponds to.
   google.protobuf.Int64Value store_id = 6;
   // The status is either "active" or "retired" for a query override.
   Status status = 7;
   // The id of the operator who creates this override mapping.
   google.protobuf.StringValue created_by = 8;
   // The id of the operator who updates this override mapping.
   google.protobuf.StringValue updated_by = 9;
   // The time that the query is created, to keep history.
   google.protobuf.Timestamp created_at = 10;
   // The time that the query is updated, to keep history.
   google.protobuf.Timestamp updated_at = 11;
}

// The vertical for which the tool is used for.
enum Verticals {
   // The vertical is unspecified.
   VERTICALS_UNSPECIFIED = 0;
   // The "GROCERY" vertical.
   VERTICALS_GROCERY = 1;
}

// The status of the query override.
enum Status {
   // The default status is unknown.
   STATUS_UNSPECIFIED = 0;
   // The status of "active".
   STATUS_ACTIVE = 1;
   // The status of "retired".
   STATUS_RETIRED = 2;
}
