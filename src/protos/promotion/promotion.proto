syntax = "proto3";

package promotion_service;

import "common/common.proto";
import "common/money.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "promotion/code.proto";
import "promotion/criterion.proto";
import "promotion/incentive.proto";
import "promotion/limitation.proto";

option go_package = "promotion";
option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.promotion";

message Promotion {
  //list of incentives/discounts available specific to this store for this promotion/campaign
  repeated Incentive incentives = 1;

  // codes specific to this store
  repeated Code code = 2;
  google.protobuf.Duration code_duration = 3;

  //determines how the can be "applied" if still valid
  repeated AppliedBy applied_by = 6;

  google.protobuf.StringValue id = 10;

  // autogenerated title
  google.protobuf.StringValue title = 8;
  google.protobuf.StringValue title_c3po_key = 11;

  // custom title override
  google.protobuf.StringValue title_override = 13;
  google.protobuf.StringValue title_override_c3po_key = 14;

  // autogenerated description
  google.protobuf.StringValue description = 9;
  google.protobuf.StringValue description_c3po_key = 12;

  // custom description override
  google.protobuf.StringValue description_override = 15;
  google.protobuf.StringValue description_override_c3po_key = 16;

  repeated StringPlaceholder title_placeholders = 17;
  repeated StringPlaceholder description_placeholders = 18;

  google.protobuf.StringValue title_with_placeholders = 19;
  google.protobuf.StringValue description_with_placeholders = 20;

  // a value that is used by external systems to identify this promotion,
  // specified at creation time
  google.protobuf.StringValue external_id = 21;

  // funding object at promotion level to support marketing fees for multi-promo per campaign in ads manager
  money.Funding funding = 22;
}

message StringPlaceholder {
  PlaceholderType type = 1;
  enum PlaceholderType {
    PLACEHOLDER_TYPE_INVALID = 0;
    PLACEHOLDER_TYPE_INT = 1;
    PLACEHOLDER_TYPE_MONETARY_FIELDS = 2;
    PLACEHOLDER_TYPE_LONG = 3;
    PLACEHOLDER_TYPE_STRING = 4;
  }
  // placeholder value: need to have 1:1 mapping with the PlaceholderType
  oneof value {
    google.protobuf.Int32Value placeholder_int = 2;
    money.MonetaryFields placeholder_monetary_fields = 3;
    google.protobuf.Int64Value placeholder_long = 4;
    google.protobuf.StringValue placeholder_string = 5;
  }
}

message AppliedBy {
  AppliedByType type = 1;
  enum AppliedByType {
    APPLIED_BY_TYPE_INVALID = 0;
    APPLIED_BY_TYPE_UNSET = 1;
    APPLIED_BY_TYPE_CLAIM = 2; // must be claimed to be used at a later time
    APPLIED_BY_TYPE_CODE = 3; // user must enter a code
    APPLIED_BY_TYPE_CLICK = 4; // user must explicitly click
    APPLIED_BY_TYPE_AUTO = 5; // get best eligible
    APPLIED_BY_TYPE_WALLET_CLICK = 6; // user must explicitly click in wallet
  }
}
