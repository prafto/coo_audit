syntax = "proto3";

package promotion_service;

import "common/common.proto";
import "common/money.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "promotion/ad_group.proto";
import "promotion/budget.proto";
import "promotion/campaign.proto";
import "promotion/common.proto";
import "promotion/custom_error_override.proto";
import "promotion/fee.proto";
import "promotion/limitation.proto";
import "promotion/membership.proto";
import "promotion/placement.proto";

option go_package = "promotion";
option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.promotion";

// Simplified schema of Campaign for the UI
message CampaignViewModel {
  google.protobuf.StringValue id = 1;
  google.protobuf.StringValue name = 2;
  google.protobuf.StringValue description = 3;

  google.protobuf.StringValue template_id = 4;
  google.protobuf.StringValue template_name = 5;

  google.protobuf.StringValue currency = 6;

  oneof value {
    money.Funding funding = 7; // not used yet
    Fee fee = 26;
  }

  google.protobuf.BoolValue is_active = 8;
  google.protobuf.Timestamp start_time = 9;
  google.protobuf.Timestamp end_time = 10;

  DayParts day_parts = 31;

  repeated PlacementViewModel placements = 11;

  repeated MembershipViewModel memberships = 12;

  repeated AudienceViewModel audiences = 13;

  PromoConfigViewModel promo_config = 14;
  PromoLimitationsViewModel promo_limitations = 15;
  PromoIncentiveViewModel promo_incentive = 16;
  PromoConditionsViewModel promo_conditions = 17;

  // Who created this record
  common.Creator created_by = 18;

  // When the record is created; generated by service
  google.protobuf.Timestamp created_at = 19;

  google.protobuf.StringValue notes = 20;

  // Custom error messages
  repeated CustomErrorOverride overrides = 21;

  google.protobuf.BoolValue is_invoiced = 22;
  google.protobuf.StringValue netsuite_entity_id = 23;
  google.protobuf.StringValue salesforce_opportunity = 24;
  google.protobuf.StringValue salesforce_opportunity_line_item_id = 25;

  google.protobuf.StringValue directly_responsible_individual = 27;
  google.protobuf.StringValue business_campaign = 28;
  Vertical.Type vertical = 29;
  google.protobuf.StringValue attribution_channel = 30;

  repeated common.Experience experiences = 32;
  repeated AdGroupViewModel ad_groups = 33;
  repeated CampaignType campaign_types = 34;
  google.protobuf.BoolValue is_free_trial = 35;
  // metadata
  map<string, string> metadata = 36;

  // Campaign level lifetime budget budget
  money.MonetaryFields campaign_lifetime_budget = 37;

  // Persisted campaign status in the DB
  State campaign_state = 38;

  // when the state of the entity is changed, this field will be populated
  StateChangeInfo state_change_info = 39;

  // Who updated this record
  common.Creator updated_by = 40;

  // When the record is updated; generated by service
  google.protobuf.Timestamp updated_at = 41;

  // multi incentive for ads manager campaigns
  repeated PromoIncentiveViewModel incentives = 42;
}

// Type of campaign
enum CampaignType {
  // unspecified
  CAMPAIGN_TYPE_UNSPECIFIED = 0;
  // ad campaign
  CAMPAIGN_TYPE_AD = 1;
  // promo campaign
  CAMPAIGN_TYPE_PROMO = 2;
  // benefit campaign
  CAMPAIGN_TYPE_BENEFIT = 3;
}

// View model of Ad group used
message AdGroupViewModel {
  google.protobuf.StringValue id = 1;
  google.protobuf.Timestamp start_time = 2;
  google.protobuf.Timestamp end_time = 3;
  repeated AudienceViewModel audiences = 4;
  repeated common.Experience experiences = 5;
  repeated google.protobuf.StringValue store_ids = 6;
  Budget budget = 7;
  Bid bid = 8;
  DayParts day_parts = 9;
}

// Where the campaign is shown
// Simplified schema for Placement
message PlacementViewModel {
  Placement.PlacementType type = 1;
  google.protobuf.StringValue content_id = 2;
  Placement.ContentIdType content_id_type = 3;
  Placement.BannerType banner_type = 4;

  google.protobuf.Int32Value sort_order = 5;
  google.protobuf.BoolValue is_active = 6;

  repeated common.Experience experiences = 7;

  map<string, string> content_id_map = 8;

  google.protobuf.StringValue experiment_name = 9;
  google.protobuf.Struct metadata = 10;

  google.protobuf.StringValue audience_name = 11;
}

// Who is in the campaign
// Simplified schema for Membership
message MembershipViewModel {
  Membership.MembershipEntityType type = 1;
  repeated string ids = 2;
}

// Determines what users see the campaign
message AudienceViewModel {
  AudienceType type = 1;
  google.protobuf.StringValue name = 2;
}

// Promotion and incentive configurations for this campaign
message PromoConfigViewModel {
  repeated google.protobuf.StringValue code = 1;
  google.protobuf.StringValue title = 2;
  google.protobuf.StringValue description = 3;

  // How to apply the promotion
  google.protobuf.BoolValue is_auto_apply = 4;
  google.protobuf.BoolValue is_click_to_apply = 5;
  google.protobuf.BoolValue is_claim_to_apply = 6;
  google.protobuf.BoolValue is_code_to_apply = 9;

  // Text overrides
  google.protobuf.StringValue title_override = 7;
  google.protobuf.StringValue description_override = 8;
}

// Limitations for users and the campaign
message PromoLimitationsViewModel {
  google.protobuf.Int32Value max_claims = 1;
  google.protobuf.Int32Value claim_duration = 2;
  google.protobuf.Int32Value max_redemption_count = 3;
  google.protobuf.Int32Value max_redemptions_per_consumer = 4;
  google.protobuf.BoolValue is_shadow = 5;
  money.MonetaryFields daily_budget = 6;
}

// Incentive discount details
message PromoIncentiveViewModel {
  google.protobuf.BoolValue waive_service_fee = 1;
  google.protobuf.BoolValue waive_small_order_fee = 2;

  // Standard discount on subtotal
  oneof value {
    google.protobuf.Int32Value flat_amount_off = 3;
    google.protobuf.Int32Value percent_off = 4;
    google.protobuf.Int32Value set_specific_value = 5;
  }
  google.protobuf.Int32Value maximum_percent_discount = 6;

  google.protobuf.Int32Value delivery_fee = 7;

  // We will save all the items to audience_service for item-promotion
  google.protobuf.StringValue items_audience_name = 8;
}

// Required conditions to apply promotion
message PromoConditionsViewModel {
  google.protobuf.BoolValue is_group_order = 1;
  google.protobuf.BoolValue is_pickup = 2;
  google.protobuf.BoolValue is_delivery = 3;

  google.protobuf.Int32Value minimum_subtotal = 4;

  repeated ItemPromoCriterionViewModel item_promo_criterion = 5;
  repeated CartCriterionOrderItemViewModel cart_criterion_order_item = 6;
  google.protobuf.BoolValue is_virtual_delivery = 7;
}

// Item needed in cart to apply promotion
message ItemPromoCriterionViewModel {
  repeated string include_keyword = 1;
  repeated string exclude_keyword = 2;
}

// Item-level promotions, with CartCriterionOrderItem as criterion
message CartCriterionOrderItemViewModel {
  google.protobuf.StringValue item_id = 1;
  google.protobuf.StringValue merchant_supplied_id = 2;
  google.protobuf.StringValue item_name = 3;
}

// Users that see the campaign, maps indirectly to UserCriterion
enum AudienceType {
  INVALID = 0;
  UNSET = 1;
  CUSTOM = 2;
  NEW_TO_DOORDASH = 3;
  CX_DASHPASS = 4;
  CX_NON_DASHPASS = 5;
  NEW_USERS_TO_MX = 6;
  NEW_USERS_TO_MX_NON_DASHPASS = 7;
  EXISTING_USERS_TO_MX = 8;
  EXISTING_USERS_TO_MX_NON_DASHPASS = 9;
  WINBACK = 10;
  ALL_USERS = 11;
  SMART_TARGETING = 12;
}
