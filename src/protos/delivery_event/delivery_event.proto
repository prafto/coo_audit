syntax = "proto3";
package delivery_event;

import "common/common.proto";
import "common/money.proto";
import "common/order.proto";
import "common/order_config.proto";
import "common/restriction_rules.proto";
import "delivery_event/common.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/doordash/services-protobuf/generated/delivery_event";
option java_multiple_files = true;
option java_package = "com.doordash.rpc.delivery_event";

// These RPC are deprecated. Use DeliveryIntelligenceService RPC instead
service DeliveryEvent {
  rpc GetEventsByDeliveryId(GetEventsByDeliveryIdRequest) returns (EventsDataResponse);
  rpc CreateDeliveryEvent(CreateDeliveryEventRequest) returns (Event);
  rpc GetCancellationReasonByDeliveryId(GetCancellationReasonRequest) returns (CancellationReasonResponse);
  rpc GetVerificationUrlByDeliveryId(GetVerificationUrlRequest) returns (VerificationUrlResponse);
}

message GetEventsByDeliveryIdRequest {
  int64 delivery_id = 1;
}

message CreateDeliveryEventRequest {
  int64 delivery_id = 1;
  string category_name = 2;
  google.protobuf.Int64Value created_by_id = 3;
  google.protobuf.StringValue metadata = 4;
}

// This protobuf will be returned as part of the event metadata in the delayed event, helping clients identify their delayed event.
message CreateDelayedEventRequest {
  // required field
  oneof id {
    google.protobuf.StringValue order_uuid = 1;
  }

  // Required field
  google.protobuf.Timestamp trigger_time = 2;

  // This client specific field and will be restricted in length - 128 characters
  google.protobuf.StringValue event_context = 3;

  // Required field
  // This key must be unique. (in comparison to all the delayed events requested by a single client)
  // Max Length - 64 characters (only alphanumeric with dash(-))
  google.protobuf.StringValue idempotency_key = 4;
}

message CreateDelayedEventResponse {
  google.protobuf.StringValue details = 1;
}

message GetCancellationReasonRequest {
  int64 delivery_id = 1;
}

message GetVerificationUrlRequest {
  int64 delivery_id = 1;
}

message EventsDataResponse {
  repeated Event event_data = 1;
}

message Address {
  // Address id
  google.protobuf.Int64Value id = 1;
  // street
  google.protobuf.StringValue street = 2;
  // city
  google.protobuf.StringValue city = 3;
  // state
  google.protobuf.StringValue state = 4;
  // postal code
  google.protobuf.StringValue postal_code = 5;
  // subpremise
  google.protobuf.StringValue subpremise = 6;
  // country
  google.protobuf.StringValue country = 7;
  // the formatted address from Address Service
  google.protobuf.StringValue formatted_address = 8;
  // lat
  google.protobuf.DoubleValue latitude = 9;
  // lng
  google.protobuf.DoubleValue longitude = 10;
  // manual pin provided by consumer
  google.protobuf.DoubleValue manual_latitude = 11;
  // manual pin provided by consumer
  google.protobuf.DoubleValue manual_longitude = 12;
  // Shortname notation of the address. Used only for showing to the consumer.
  // Don't use this to parse the address information.
  google.protobuf.StringValue address_short_name = 13;
}

message Event {
  int64 id = 1;
  EventCategory category = 2;
  google.protobuf.Timestamp created_at = 3;
  DispatchUser created_by = 4;
  int64 delivery_id = 5;
  Issue issue = 6;
  google.protobuf.StringValue metadata = 7;
  DeliveryContext delivery_context = 8;
  google.protobuf.StringValue delivery_uuid = 9;
  google.protobuf.Int64Value dasher_id = 10;
  google.protobuf.StringValue consumer_id = 11;
  google.protobuf.Int64Value store_id = 12;
  google.protobuf.StringValue order_uuid = 13;
}

message DispatchUser {
  google.protobuf.StringValue id = 1;
  google.protobuf.StringValue email = 2;
  google.protobuf.StringValue first_name = 3;
  google.protobuf.StringValue last_name = 4;
  google.protobuf.StringValue object_type = 5;
}

message CancellationReasonResponse {
  string cancellation_event_category_name = 1;
  string internal_reason = 2;
  string free_form_reason = 3;
  google.protobuf.StringValue cancelled_by = 4;
  google.protobuf.StringValue friendly_formatted_cancellation_reason = 5;
  // An uploaded explanation on why the order was cancelled, currently can be free-form text that the support agent enters
  google.protobuf.StringValue cancellation_notes = 6;
}

message VerificationUrlResponse {
  string deliveryVerificationUrl = 1;
}

/** contains the possible consumer order statuses **/
// DEPRECATED we are moving to DeliveryStatus
enum OrderStatus {
  // placeholder for unspecified status
  ORDER_STATUS_UNSPECIFIED = 0;

  // These fields has been deprecated/renamed to be more clear
  reserved 1; // ORDER_STATUS_SCHEDULED = 1;
  reserved 3; // ORDER_STATUS_ORDER_CONFIRMED = 3;
  reserved 4; // ORDER_STATUS_ORDER_RELEASED = 4;
  reserved 5; // ORDER_STATUS_DASHER_ASSIGNMENT_CONFIRMED = 5;
  reserved 6; // ORDER_STATUS_DASHER_ARRIVED_AT_STORE = 6;
  reserved 7; // ORDER_STATUS_ORDER_READY = 7;
  reserved 8; // ORDER_STATUS_ORDER_PICKED_UP = 8;
  reserved 9; // ORDER_STATUS_DASHER_NEARBY = 9;

  // Order is placed
  ORDER_STATUS_ORDER_PLACED = 2;
  // Order is completed
  ORDER_STATUS_ORDER_COMPLETED = 10;
  // Order is cancelled
  ORDER_STATUS_ORDER_CANCELLED = 11;
  // Delivery is created
  ORDER_STATUS_DELIVERY_CREATED = 12;
  // Store has confirmed order
  ORDER_STATUS_STORE_CONFIRMED_ORDER = 13;
  // Store has confirmed ready for pickup
  ORDER_STATUS_STORE_CONFIRMED_READY_FOR_PICKUP = 14;
  // Dasher confirmed assignment
  ORDER_STATUS_DASHER_CONFIRMED_ASSIGNMENT = 15;
  // Dash is arriving at store
  ORDER_STATUS_DASHER_ARRIVING_AT_STORE = 16;
  // Dasher confirmed at store
  ORDER_STATUS_DASHER_CONFIRMED_AT_STORE = 17;
  // Dasher is arriving at Cx
  ORDER_STATUS_DASHER_ARRIVING_AT_CONSUMER = 18;
  // Dasher confirmed at Cx
  ORDER_STATUS_DASHER_CONFIRMED_AT_CONSUMER = 19;
  // Order has been picked up
  ORDER_STATUS_ORDER_PICKED_UP = 20;
}

// Overall status of a delivery
enum DeliveryStatus {
  // placeholder for unspecified status
  DELIVERY_STATUS_UNSPECIFIED = 0;
  // An order is placed
  DELIVERY_STATUS_ORDER_PLACED = 1;
  // Delivery is created
  DELIVERY_STATUS_DELIVERY_CREATED = 2;
  // Order is completed
  DELIVERY_STATUS_ORDER_COMPLETED = 3;
  // Order is cancelled
  DELIVERY_STATUS_ORDER_CANCELLED = 4;
  // Store has confirmed order
  DELIVERY_STATUS_STORE_CONFIRMED_ORDER = 5;
  // Store has confirmed ready for pickup
  DELIVERY_STATUS_STORE_CONFIRMED_READY_FOR_PICKUP = 6;
  // Dasher confirmed assignment
  DELIVERY_STATUS_DASHER_CONFIRMED_ASSIGNMENT = 7;
  // Dasher is arriving at store
  DELIVERY_STATUS_DASHER_ARRIVING_AT_STORE = 8;
  // Dasher confirmed at store
  DELIVERY_STATUS_DASHER_CONFIRMED_AT_STORE = 9;
  // Dasher is arriving at Cx
  DELIVERY_STATUS_DASHER_ARRIVING_AT_CONSUMER = 10;
  // Dasher confirmed at Cx
  DELIVERY_STATUS_DASHER_CONFIRMED_AT_CONSUMER = 11;
  // Order has been picked up
  DELIVERY_STATUS_ORDER_PICKED_UP = 12;
}

message DeliveryContext {
  ConsumerDetails consumer_details = 1;
  DasherDetails dasher_details = 2;
  MerchantDetails merchant_details = 3;
  ETADetails eta_details = 4;
  OrderDetails order_details = 5;
  DeliveryDetails delivery_details = 6;
  ItemsDetails item_details = 7;
  ConsumerOrderDetails consumer_order_details = 8;

  /** Contains all of the consumer details. */
  message ConsumerDetails {
    // This field is deprecated. Please use first_name and last_name fields instead.
    google.protobuf.StringValue name = 1 [deprecated = true];

    /** Delivery address */
    message DeliveryAddress {
      // Delivery UUID.
      google.protobuf.Int64Value id = 1;
      // Delivery street.
      google.protobuf.StringValue street = 2;
      // Delivery city.
      google.protobuf.StringValue city = 3;
      // Delivery state.
      google.protobuf.StringValue state = 4;
      // Delivery zipcode.
      google.protobuf.StringValue zipcode = 5;
      // Delivery subpremise.
      google.protobuf.StringValue subpremise = 6;
      // Delivery dasher instructions.
      google.protobuf.StringValue dasher_instructions = 7;
      // Latitude of the consumer's address they placed their order with. Note this doesn't refer to the manual pin they set via the consumer app.
      google.protobuf.DoubleValue latitude = 8;
      // Longitude of the consumer's address they placed their order with. Note this doesn't refer to the manual pin they set via the consumer app.
      google.protobuf.DoubleValue longitude = 9;
      // Latitude of the consumer's address they placed their order with. Refers to the manual pin they set via the consumer app.
      google.protobuf.DoubleValue manual_latitude = 10;
      // Longitude of the consumer's address they placed their order with. Refers to the manual pin they set via the consumer app.
      google.protobuf.DoubleValue manual_longitude = 11;
      // Shortname notation of the address. Used only for showing to the consumer. Don't use this to parse the address information.
      google.protobuf.StringValue short_name = 12;
      // the formatted address from Address Service
      google.protobuf.StringValue formatted_address = 13;

      /** Drop off details */
      message DropOffDetails {
        /** Drop off options */
        enum DropOffOption {
          // Dasher can leave the delivery at the manual pin [DeliveryAddress.manual_latitude] & [DeliveryAddress.manual_longitude] specified by the consumer.
          // This is the default option that OTS sends as a fallback.
          DROP_OFF_OPTION_LEAVE_IT_AT_MY_DOOR_UNSPECIFIED = 0;
          // Dasher has to hand the delivery to the consumer in person.
          DROP_OFF_OPTION_HAND_IT_TO_ME = 1;
        }
        //  The drop-off option (leave at my door or hand it to me).
        DropOffOption option = 1;
        // Drop off instructions.
        google.protobuf.StringValue instructions = 2;
      }
      // Drop off details.
      DropOffDetails dropoff_details = 14;

      // Consumer address link id which is another id associated with consumer and address
      google.protobuf.Int64Value consumer_address_link_id = 15;

      // describes possible selections for consumer_dropoff_location_preference
      enum ConsumerDropoffLocationPreference {
        // cx has not specified anything
        CONSUMER_DROPOFF_LOCATION_PREFERENCE_UNSPECIFIED = 0;
        // cx selected hotel_room
        CONSUMER_DROPOFF_LOCATION_PREFERENCE_HOTEL_ROOM = 1;
        // cx selected hotel_lobby
        CONSUMER_DROPOFF_LOCATION_PREFERENCE_HOTEL_LOBBY = 2;
      }
      // Cx selection of ConsumerDropoffLocationPreference, this is used for Hyperlocal hotel confidence experimentation
      ConsumerDropoffLocationPreference consumer_dropoff_location_preference = 16;

      // Difficulty Address Score
      google.protobuf.Int64Value address_score = 17;

      // Delivery entry code.
      google.protobuf.StringValue entry_code = 18;

      // Source Place id.
      google.protobuf.StringValue source_place_id = 19;
    }
    // Delivery address.
    DeliveryAddress address = 2;
    // the order creator's consumer_id
    google.protobuf.Int64Value consumer_id = 3;
    // the order creator's user id
    google.protobuf.Int64Value user_id = 4;
    reserved 5;
    reserved "consumer_ids";
    // If it's a guest consumer
    google.protobuf.BoolValue is_guest = 6;
    // Defines the consumer experience that was used for this order eg Doordash / Caviar etc
    enum ConsumerExperience {
      // Unknown
      CONSUMER_EXPERIENCE_UNSPECIFIED = 0;
      // Cx is using DD apps
      CONSUMER_EXPERIENCE_DOORDASH = 1;
      // Cx is using Caviar app
      CONSUMER_EXPERIENCE_CAVIAR = 2;
      // Cx is using Store Front web app
      CONSUMER_EXPERIENCE_STOREFRONT = 3;
      // Cx orders direct from Drive partner
      CONSUMER_EXPERIENCE_DRIVE = 4;
      // Cx orders direct from Voice Ordering UI
      CONSUMER_EXPERIENCE_VOICE = 5;
      // Cx orders direct from Bbot web app
      CONSUMER_EXPERIENCE_BBOT = 6;
    }
    // Defines the consumer experience that was used for this order eg Doordash / Caviar etc
    ConsumerExperience consumer_experience = 7;
    // Consumer first name.
    google.protobuf.StringValue first_name = 8;
    // Consumer last name.
    google.protobuf.StringValue last_name = 9;
    // Consumer district id
    google.protobuf.Int64Value district_id = 10;
    // Consumer email address
    google.protobuf.StringValue email = 11;
    // Consumer phone number
    google.protobuf.StringValue phone_number = 12;
    // Consumer locale
    google.protobuf.StringValue locale = 13;

    message GroupCartConsumer {
      google.protobuf.StringValue consumer_id = 1;
      google.protobuf.BoolValue is_guest = 2;
      google.protobuf.BoolValue is_creator = 3;
      google.protobuf.BoolValue is_company_account = 4;
      google.protobuf.BoolValue is_employee = 5;
    }

    // If this is a group cart, the list of GroupCartConsumer involved in the group cart, otherwise null
    repeated GroupCartConsumer groupCartConsumers = 14;
    // Consumer catering contact email address (used for storefront and drive only)
    google.protobuf.StringValue catering_contact_email = 15;
    // Timestamp when Consumer Context was last updated
    google.protobuf.Timestamp updated_at = 16;

    // To monitor orders from DDFB Cx using RDT
    enum DDFBConsumerType {
      // Unknown
      DDFB_CONSUMER_TYPE_UNSPECIFIED = 0;
      // DDFB portal admin
      DDFB_CONSUMER_TYPE_WP_ADMIN = 1;
      // DDFB portal member
      DDFB_CONSUMER_TYPE_WP_MEMBER = 2;
    }

    // To monitor orders from DDFB Cx using RDT
    DDFBConsumerType ddfb_consumer_type = 17;

    // Senders can customize their name on orders they send to others. This stores the name they would like to be
    // addressed as on gift notifications to their recipients
    google.protobuf.StringValue gift_sender_name = 18;
  }

  /** Contains all of the dasher details. */
  message DasherDetails {
    message VehicleInfo {
      // Dasher vehicle_type
      google.protobuf.StringValue vehicle_type = 1;
      // Dasher vehicle_make
      google.protobuf.StringValue vehicle_make = 2;
      // Dasher vehicle_model
      google.protobuf.StringValue vehicle_model = 3;
      // Dasher vehicle_year
      google.protobuf.StringValue vehicle_year = 4;
      // Dasher vehicle_color
      google.protobuf.StringValue vehicle_color = 5;
      // Dasher vehicle_id
      google.protobuf.Int64Value vehicle_id = 6;
    }
    // Dasher profile id for the Dasher assigned to this delivery
    google.protobuf.Int64Value dasher_id = 1;
    // Dasher first name.
    google.protobuf.StringValue first_name = 2;
    // Dasher last name.
    google.protobuf.StringValue last_name = 3;
    // Dasher latitude.
    google.protobuf.FloatValue latitude = 4;
    // Dasher longitude.
    google.protobuf.FloatValue longitude = 5;
    // Whether the Dx is textable by the consumer for this delivery
    google.protobuf.BoolValue contact_is_textable = 6;
    // Timestamp of dasher associated with the location
    google.protobuf.Timestamp timestamp = 7;
    // Dasher phone number.
    google.protobuf.StringValue phone_number = 8;
    // Delivery vehicle info
    VehicleInfo vehicle_info = 9;
    // Dasher default fraud composite score
    google.protobuf.FloatValue fraud_composite_score = 10;
    // Dx completion rate
    google.protobuf.FloatValue completion_rate = 11;
    // Earnings Mode of the Dx
    google.protobuf.StringValue earnings_mode = 12;
    // Is the dasher manually assigned
    google.protobuf.BoolValue manually_assigned = 13;
    // dasher's user id
    google.protobuf.Int64Value dasher_user_id = 14;
    // Timestamp when Dasher Context was last updated
    google.protobuf.Timestamp updated_at = 15;
    // True if the dasher is inside the merchant geofence
    // This is driven by DLC events for when the dasher enters and leaves the geofence
    // We use this on the order tracking page to only show the dasher as "arrived" when they are inside the geofence
    google.protobuf.BoolValue is_inside_mx_geofence = 16;
    // URL of a dasher profile picture
    google.protobuf.StringValue profile_picture_url = 17;
    // Dasher's preferred name
    google.protobuf.StringValue preferred_name = 18;
    // Contract type of dasher
    google.protobuf.StringValue contract_type = 19;
  }

  /** Contains all of the merchant details. */
  message MerchantDetails {
    // Merchant store id
    google.protobuf.Int64Value store_id = 1;
    // Merchant name. This field is the same as business_name.
    // TODO: This field will be deprecated in the future.
    google.protobuf.StringValue name = 2;
    // Merchant latitude.
    google.protobuf.DoubleValue latitude = 3;
    // Merchant longitude.
    google.protobuf.DoubleValue longitude = 4;
    // Merchant phone number.
    google.protobuf.StringValue phone_number = 5;

    /** Contains pickup address info. */
    message PickupAddress {
      // the address ID
      google.protobuf.Int64Value id = 1;
      // Pickup street address.
      google.protobuf.StringValue street = 2;
      // Pickup city address.
      google.protobuf.StringValue city = 3;
      // Pickup state address.
      google.protobuf.StringValue state = 4;
      // Pickup zipcode address.
      google.protobuf.StringValue zipcode = 5;
      // Pickup subpremise address.
      google.protobuf.StringValue subpremise = 6;
      // Pickup printable address.
      google.protobuf.StringValue formatted_address = 7;
      // Pickup latitude address.
      google.protobuf.DoubleValue latitude = 8;
      // Pickup longitude address.
      google.protobuf.DoubleValue longitude = 9;
      // Country of the store
      google.protobuf.StringValue country = 10;
    }
    // Pickup address info.
    PickupAddress address = 6;
    // Merchant timezone.
    google.protobuf.StringValue timezone = 7;
    // Merchant business id.
    google.protobuf.Int64Value business_id = 8;
    // Merchant bundled image url.
    google.protobuf.StringValue bundled_image_url = 9;
    // Country shortname for the merchant
    google.protobuf.StringValue country_shortname = 10;
    // Merchant business vertical id
    google.protobuf.Int64Value business_vertical_id = 11;
    // absolute path of business header img url
    google.protobuf.StringValue header_img_url = 12;
    // absolute path of business cover img url
    google.protobuf.StringValue cover_img_url = 13;
    // absolute path of business cover square img url
    google.protobuf.StringValue cover_square_img_url = 14;
    // Whether the business sells Hot and Prepared items on the retail UI
    google.protobuf.BoolValue does_business_sell_hot_prepared_items = 15;
    // Merchant store name
    google.protobuf.StringValue store_name = 16;
    // Merchant business name
    google.protobuf.StringValue business_name = 17;
    // Timestamp when Merchant Context was last updated
    google.protobuf.Timestamp updated_at = 18;
    // Is same day onboarding
    google.protobuf.BoolValue is_same_day_onboarding = 19;
  }

  /** Contains all of the ETA details. */
  message ETADetails {
    reserved 1;
    reserved 2;
    // ETA estimated delivery time.
    google.protobuf.Timestamp eta = 3;
    // ETA max estimated delivery time.
    google.protobuf.Timestamp eta_range_max = 4;
    // ETA min estimated delivery time.
    google.protobuf.Timestamp eta_range_min = 5;
    // ETA quoted delivery time.
    google.protobuf.Timestamp quoted_delivery_time = 6;
    // ETA estimated pickup time.
    google.protobuf.Timestamp estimated_pickup_time = 7;
    // Estimated store prep time
    google.protobuf.Timestamp estimated_store_prep_time = 8;

    message Factors {
      // Dasher Route Point Representation
      enum RoutePointType {
        // Default type as unspecified
        ROUTE_POINT_TYPE_UNSPECIFIED = 0;
        // Type pick-up from Assignment Service
        ROUTE_POINT_TYPE_PICKUP = 1;
        // Type deliver from Assignment Service
        ROUTE_POINT_TYPE_DELIVER = 2;
      }
      message RoutePoint {
        // Latitude
        double lat = 1;
        // Longitude
        double lng = 2;
        // Type of Route Point
        RoutePointType type = 3;
        google.protobuf.Int64Value delivery_id = 4; // legacy delivery id from Assignment-Service
      }
      // Route points are in order of assignment
      repeated RoutePoint route_points = 1;
    }
    Factors factors = 9;

    message ExpectedLateness {
      // The state of the delivery
      enum State {
        // Default state as unspecified
        STATE_UNSPECIFIED = 0;
        // Delivery is on time
        STATE_ON_TIME = 1;
        // Delivery is late
        STATE_LATE = 2;
      }
      // The reason of lateness
      enum LatenessReason {
        // Default value as unspecified
        LATENESS_REASON_UNSPECIFIED = 0;
        // Delivery is not late
        LATENESS_REASON_NOT_LATE = 1;
        // Caused by Dasher confirmation latency
        LATENESS_REASON_DASHER_CONFLAT = 2;
        // Caused by merchant preparation takes too long
        LATENESS_REASON_MERCHANT_PREP_TIME = 3;
      }
      State state = 1;
      LatenessReason reason = 2;
      int64 lateness_seconds = 3;
    }
    ExpectedLateness max_expected_lateness = 10;
    // Timestamp when ETA Context was last updated
    google.protobuf.Timestamp updated_at = 11;
  }

  /** Contains all of the order details. */
  message OrderDetails {
    // Order cart id.
    google.protobuf.Int64Value order_cart_id = 1;
    // Order UUID.
    google.protobuf.StringValue order_uuid = 2;
    // The market id for this order
    google.protobuf.Int64Value market_id = 3;
    // The submarket id for this order
    google.protobuf.Int64Value submarket_id = 4;
    reserved 5; // order_status
    reserved "order_status";
    reserved 6; // order_status_last_updated
    reserved "order_status_last_updated";
    // Whether this is a test order
    google.protobuf.BoolValue is_test = 7;
    // Whether this order is a pickup order.
    google.protobuf.BoolValue is_pickup = 8;
    // Whether this order is an asap or a scheduled order
    google.protobuf.BoolValue is_asap = 9;
    // Whether this is a Drive order
    google.protobuf.BoolValue is_from_store_to_us = 10;
    // If it's a group cart
    google.protobuf.BoolValue is_group_cart = 11;
    // Flag to indicate if DashPass discounts were applied to the order
    google.protobuf.BoolValue is_dash_pass_order = 12;

    // Whether contains Alcohol
    google.protobuf.BoolValue contains_alcohol = 13;
    // Gift info
    google.protobuf.BoolValue is_gift = 14;

    // Defines the recipient delivery status
    enum RecipientDeliveryStatus {
      // Default case - recipient cannot schedule
      RECIPIENT_DELIVERY_STATUS_UNSCHEDULABLE_UNSPECIFIED = 0;

      // Recipient has not yet scheduled delivery
      RECIPIENT_DELIVERY_STATUS_UNSCHEDULED = 1;

      // Gift delivery is scheduled by recipient
      RECIPIENT_DELIVERY_STATUS_SCHEDULED = 2;
    }
    RecipientDeliveryStatus gift_delivery_status = 15;
    google.protobuf.StringValue gift_recipient_name = 16;

    // Age restriction info
    // Defines the vender used for age verification
    enum AgeRestrictedIdVerificationVendor {
      // Default the VENDOR is none
      AGE_RESTRICTED_ID_VERIFICATION_VENDOR_VENDOR_NONE_UNSPECIFIED = 0;
      // Vendor PERSONA
      AGE_RESTRICTED_ID_VERIFICATION_VENDOR_VENDOR_PERSONA = 1;
    }
    message OrderAgeRestrictedIdVerification {
      string id_photo_url = 1;
      AgeRestrictedIdVerificationVendor vendor = 2 [deprecated = true];
      google.protobuf.Int32Value min_age_requirement = 3;
      google.protobuf.BoolValue is_bouncer_case_enabled = 4;
      common.AgeRestrictedIdVerificationVendor verification_vendor = 5;
    }
    OrderAgeRestrictedIdVerification age_restricted_id_verification = 17;

    // Bundle order UUID
    google.protobuf.StringValue primary_bundled_order_uuid = 18;
    repeated google.protobuf.StringValue bundled_order_uuids = 19;

    // Whether is shipping
    google.protobuf.BoolValue is_shipping = 20;
    // Substitution
    google.protobuf.StringValue substitution_type = 21;

    // This field is moved to DeliveryDetails since this is a logistics field
    google.protobuf.BoolValue signature_required = 22 [deprecated = true];
    // Order cart create info
    google.protobuf.StringValue order_cart_created_at = 23;
    // Order cart cancel info
    google.protobuf.StringValue order_cart_cancelled_at = 24;

    message OrderGrandTotal {
      google.protobuf.Int32Value subtotal = 1;
      google.protobuf.Int32Value tax_amount = 2;
      google.protobuf.Int32Value delivery_fee = 3;
      google.protobuf.Int32Value service_fee = 4;
      google.protobuf.Int32Value tip_amount = 5;
      google.protobuf.Int32Value subtotal_discount = 6;
      google.protobuf.Int32Value discount_amount = 7;
      google.protobuf.StringValue currency = 8;
      google.protobuf.Int32Value subtotal_decimal_places = 9;
      google.protobuf.StringValue subtotal_display_string = 10;
    }
    OrderGrandTotal gov = 25;

    // Order cart timestamps
    google.protobuf.Timestamp created_at = 26;
    google.protobuf.Timestamp cancelled_at = 27;

    // For post-checkout showing catering info
    google.protobuf.Int32Value cancel_order_in_advance_in_seconds = 28;

    // Order config
    message OrderConfig {
      // Defines if this order is a bundle order bundled pre or post of checkout
      common.order_config.v1.OrderConfig.BundleType bundle_type = 1;
      // Defines the role the order plays in the bundle order case
      common.order_config.v1.OrderConfig.BundleOrderRole bundle_order_role = 2;
      // shopping protocol of a retail order
      common.order_config.v1.OrderConfig.ShoppingProtocol shopping_protocol = 3;
      // order type of a package order
      common.order_config.v1.OrderConfig.PackageOrderType package_order_type = 4;
      // defines if the order is an order with multiple consumers involved (expensed meals / group orders etc)
      common.order_config.v1.OrderConfig.GroupOrderType group_order_type = 5;
      // Defines the meal train details associated with this order when applicable, if present, it means this is a meal train order
      common.order_config.v1.MealTrainOrderDetails meal_train__order_details = 6;
      // delivery option type
      common.order_config.v1.OrderConfig.DeliveryOptionType delivery_option_type = 7;
      // map to order_config.is_cx_curbside
      google.protobuf.BoolValue is_cx_curbside = 8;

      // deprecated: dd_pos_order_details
      reserved 9;
      // deprecated: dd_pos_order_details
      reserved "dd_pos_order_details";

      // payment method that was used to pay for the order
      common.order_config.v1.OrderConfig.PaymentMethod payment_method = 10;

      // Defines the last external touchpoint before the customer lands on our platform (DoorDash/Caviar marketplace, Pay with DoorDash APIs, Drive APIs, Storefront APIs)
      common.order_config.v1.OrderConfig.ExternalChannel external_channel = 11;

      // Defines the product / vertical the order belongs to
      common.order_config.v1.OrderConfig.ProductLine product_line = 12;

      // defines the order profile - should be business if business profile order has been placed
      common.order_config.v1.OrderConfig.OrderProfileType order_profile_type = 13;

      // DashParty specific order details
      common.order_config.v1.DashPartyOrderDetails dashparty_order_details = 14;
    }
    OrderConfig order_config = 29;

    // Contains information regarding cancelled orders that are going through the 2-step cancellation experience.
    order.CancellationPendingRefundInfo cancellation_pending_refund_info = 30;

    // Shipment info if the order is shipping type
    order.OrderShipmentInfo shipment_info = 31;

    // Platform that consumer submits the order
    google.protobuf.StringValue submit_platform = 32;

    reserved 33;
    reserved 34;

    // Whether this delivery is at dark hour
    google.protobuf.BoolValue is_dark_hour = 35;

    // Dropoff verification related info
    message DeliveryVerificationInfo {
      // The url of the photo driver takes for delivery verification
      google.protobuf.StringValue photo_url = 1;
      // The location description driver put for delivery verification
      google.protobuf.StringValue location_description = 2;
      // Latitude of the location driver drop the delivery
      google.protobuf.DoubleValue latitude = 3;
      // Longitude of the location driver drop the delivery
      google.protobuf.DoubleValue longitude = 4;
      // Distance from customer in meters
      google.protobuf.DoubleValue distance_from_customer = 5;
    }
    DeliveryVerificationInfo delivery_verification_info = 36;

    // Whether the order is the first order
    google.protobuf.BoolValue is_first_order = 37;

    // Order cancellation reason
    order.CancellationReason cancellation_reason = 38;

    // fulfillment type
    common.order_config.v1.OrderConfig.FulfillmentType fulfillment_type = 39;

    reserved 40;

    // value of contents for Drive Order
    // Drive order has 0 subtotal amount from order service.
    // Instead, this field represents the value.
    google.protobuf.Int64Value value_of_contents = 41;

    // This field used by Tx to allow switch auto/manual order placement
    google.protobuf.BoolValue should_be_manually_placed = 42;

    // store order cart id (typically from OLC events)
    google.protobuf.Int64Value store_order_cart_id = 43;

    // If this delivery is a post-cancellation reorder, this field stores information about the parent order and reorder type
    order.CancellationReorderInfo cancellation_reorder_info = 44;
    Address pickup_address = 45;
    Address dropoff_address = 46;

    google.protobuf.Int64Value starting_point_id = 47;

    // data related to proof of delivery
    message ProofOfDelivery {
      // type of proof of delivery
      order.ProofOfDeliveryType proof_of_delivery_type = 1;
      // more info to store regarding proof of delivery
      map<string, string> details = 2;
    }

    // proof of delivery info related to order
    ProofOfDelivery proof_of_delivery = 48;
    // Timestamp when Order Context was last updated
    google.protobuf.Timestamp updated_at = 49;

    // information about a credits and refunds event
    message CreditsAndRefundsEvents {
      // error id for this credit and refund event
      google.protobuf.Int64Value cnr_error_id = 1;
      // type of cnr event
      google.protobuf.StringValue cnr_category = 2;
      // amount of credits given to the consumer in this cnr event
      google.protobuf.Int32Value consumer_credits = 3;
      // amount refunded to the consumer in this cnr event
      google.protobuf.Int32Value consumer_refund = 4;
      // amount charged to the customer in this cnr event
      google.protobuf.Int32Value consumer_charge = 5;
      // timestamp when this cnr event was created
      google.protobuf.Timestamp created_at = 6;
      // type of cre_categories (dispatch error problem names)
      repeated string sub_categories = 7;
    }

    //a list of credits and refunds events related to order
    repeated CreditsAndRefundsEvents credits_and_refunds_events = 50;

    // For gift orders, this is the phone number of the recipient.
    google.protobuf.StringValue gift_recipient_phone_number = 51;

    /** Contains information about the return of an order **/
    message ReturnOrderInfo {
      reserved 9;
      reserved "order_resolution_preview_id";

      // When the Cx uploads the return receipt, the image URL
      google.protobuf.StringValue return_receipt_upload = 1;
      // Original order barcode "123456"
      google.protobuf.StringValue original_order_barcode = 2;

      /** Indicates the status of a return **/
      enum ReturnOrderStatus {
        reserved 3;
        reserved "RETURN_ORDER_STATUS_IN_PROCESS";

        // UNSPECIFIED
        RETURN_ORDER_STATUS_UNSPECIFIED = 0;
        // NOT STARTED
        RETURN_ORDER_STATUS_NOT_STARTED = 1;
        // INITIATED
        RETURN_ORDER_STATUS_INITIATED = 2;
        // RETURN COMPLETE
        RETURN_ORDER_STATUS_COMPLETE = 4;
        // REFUND COMPLETE
        RETURN_ORDER_STATUS_REFUND_COMPLETE = 5;
        // RETURN RECEIPT BARCODE SCANNED
        RETURN_ORDER_STATUS_RETURN_RECEIPT_BARCODE_SCANNED = 6;
        // RETURN RECEIPT UPLOADED
        RETURN_ORDER_STATUS_RETURN_RECEIPT_UPLOADED = 7;
        // RETURN APPROVED
        RETURN_ORDER_STATUS_RETURN_APPROVED = 8;
        // RETURN REJECTED
        RETURN_ORDER_STATUS_RETURN_REJECTED = 9;
      }

      // What step of the return is the Cx in right now
      ReturnOrderStatus status = 3;
      // Items eligible to be returned
      repeated google.protobuf.StringValue returnable_item_ids = 4;
      // Resolution options for the return
      google.protobuf.StringValue resolution_metadata = 5;
      // 30 days from now for example
      google.protobuf.Timestamp final_return_date = 6;
      // true v false depending on Mx
      google.protobuf.BoolValue receipt_upload_required = 7;
      // Original receipt captured by Dx
      google.protobuf.StringValue original_receipt_image = 8;
      // Different copy for inflating Mx
      google.protobuf.BoolValue is_inflating_Mx = 10;
      // Return amount upon return complete
      google.protobuf.Int32Value return_amount = 11;
    }

    // For orders the Cx will return
    ReturnOrderInfo return_order_info = 52;

    // Determines if this order is eligible for switching payment methods
    google.protobuf.BoolValue is_switch_payment_method_eligible = 53;

    // The points summary information of DoorDash loyalty platform, directly from ConsumerPricingDetails
    money.DoorDashLoyaltyPointsSummary doordash_loyalty_points_summary = 54;

    // identifier for the parent consumer-order-uuid
    google.protobuf.StringValue consumer_order_uuid = 55;
  }

  /** Contains all of the delivery details. */
  message DeliveryDetails {
    // Delivery ID.
    google.protobuf.Int64Value delivery_id = 1;
    // Delivery UUID.
    google.protobuf.StringValue delivery_uuid = 2;
    // Fullfillment type from deliverylifecycle topic. will be deprecated in the future, use order details FulfillmentType enum over this
    google.protobuf.StringValue fulfillment_type = 3;
    // Whether delivery is batched at this time.
    google.protobuf.BoolValue is_batched = 4;
    // The batch id of the delivery if the delivery is a batch delivery
    google.protobuf.Int64Value batch_id = 5;
    // The Shift Id of the Delivery Event
    google.protobuf.Int64Value shift_id = 6;
    // The protocol type of the delivery
    google.protobuf.StringValue order_protocol_type = 7;
    // Source of the delivery
    google.protobuf.StringValue source = 8;

    // Delivery created at
    google.protobuf.Timestamp created_at = 9;
    // The time at which the order was canceled
    google.protobuf.Timestamp cancelled_at = 10;
    // The time the Dasher picked up the order (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp actual_pickup_time = 11;
    // The time at which the order was delivered (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp actual_delivery_time = 12;
    // The time the merchant confirmed the order (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp store_order_confirmed_time = 13;
    // Actual order ready time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp actual_order_ready_time = 14;
    // Dasher assigned time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_assigned_time = 15;
    // Dasher confirmed time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_confirmed_time = 16;
    // Dasher arrive store time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_arriving_at_store_time = 17;
    // Dasher confirm at store time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_confirmed_at_store_time = 18;
    // Dasher arriving at consumer location time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_arriving_at_consumer_time = 19;
    // Dasher confirm at consumer time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp dasher_confirmed_at_consumer_time = 20;
    // Quoted delivery time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp quoted_delivery_time = 21;
    // Dasher Instruction for the delivery
    google.protobuf.StringValue dasher_instructions = 22;

    // Is contactless delivery or not
    google.protobuf.BoolValue is_contactless_delivery = 23;
    // Total count of confirmed dasher for the delivery
    google.protobuf.Int32Value dasher_confirmed_count = 24;
    // The timestamp of the latest dasher confirmation for the delivery
    google.protobuf.Timestamp previous_value_dasher_confirmed_time = 25;
    // Whether the delivery is a return of an another delivery. if true parent_delivery_uuid is available
    google.protobuf.BoolValue is_return_delivery = 26;
    // The Shift ID of the dasher that got unassigned
    google.protobuf.Int64Value unassigned_shift_id = 27;
    // is_excused is set to true for some delivery events specifically driver un-assign events by delivery service
    google.protobuf.BoolValue is_excused = 28;
    // The delivery package ID from create assignment
    google.protobuf.Int64Value delivery_package_id = 29;
    // delivery abandoned timestamp
    google.protobuf.Timestamp delivery_abandoned_at = 30;
    // Delivery assignment constraint. Delivery window start time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp delivery_window_start_time = 31;
    // Delivery assignment constraint. Delivery window end time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp delivery_window_end_time = 32;
    // delivery assignment constraint. Evaluated status of the delivery
    DeliveryStatus delivery_status = 33;
    // Delivery assignment constraint info
    google.protobuf.StringValue experiment_info = 34;
    // Delivery cash on delivery
    google.protobuf.Int64Value cash_on_delivery = 35;
    // Should the dasher be manually assigned
    google.protobuf.BoolValue should_be_manually_assigned = 36;
    // Parent delivery id
    google.protobuf.Int64Value parent_delivery_id = 37;
    // Parent delivery uuid
    google.protobuf.StringValue parent_delivery_uuid = 38;

    google.protobuf.Int64Value onsite_estimated_prep_time = 39;
    google.protobuf.Timestamp onsite_estimated_prep_time_updated_at = 40;

    // Market name in string
    google.protobuf.StringValue market_shortname = 41;

    // Whether requires red card for dasher to get this delivery
    google.protobuf.BoolValue requires_payment_card = 42;

    // Is delivery preassignable or not (typically populated from DLC)
    google.protobuf.BoolValue is_preassignable = 43;

    // original_delivery_uuid for return deliveries
    google.protobuf.StringValue original_delivery_uuid = 44;

    reserved 45;

    reserved 46;
    reserved "is_route_based_delivery";

    // is route based delivery (typically from delivery service)
    google.protobuf.BoolValue is_route_based = 47;
    // idempotency key created during delivery creation
    google.protobuf.StringValue idempotency_key = 48;
    // if delivery has return delivery, return delivery_uuid is set
    google.protobuf.StringValue return_delivery_uuid = 49;
    // Timestamp when Delivery Context was last updated
    google.protobuf.Timestamp updated_at = 50;
    // Delivery assignment constraint. pickup window start time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp pickup_window_start_time = 51;
    // Delivery assignment constraint. pickup window end time (typically populated from Delivery Lifecycle Events)
    google.protobuf.Timestamp pickup_window_end_time = 52;
    // Whether a signature is required for a delivery
    google.protobuf.BoolValue signature_required = 53;
  }

  /** Contains information about the items within an order **/
  message ItemsDetails {
    message Item {
      // name of the item
      google.protobuf.StringValue name = 1;
      // description of the item
      google.protobuf.StringValue description = 2;
      // quantity of the item
      google.protobuf.Int64Value quantity = 3;
      // bundle_key of the item
      google.protobuf.StringValue bundle_key = 4;
      // is_alcohol of the item
      google.protobuf.BoolValue is_alcohol = 5;
      // item id in dimension_menu_item
      google.protobuf.Int64Value item_id = 6;
      // order_item_id in maindb_order_item
      google.protobuf.Int64Value order_item_id = 7;
      // rules associated with this item
      common.restriction_rules.v1.RestrictionInfoWRules restriction_info_w_rules = 8;
      // merchant_supplied_id of the item
      google.protobuf.StringValue merchant_supplied_id = 9;
      // String value of OutOfStockStatus enum from delivery-core
      google.protobuf.StringValue oos_status = 10;
      // image_url of the item
      google.protobuf.StringValue image_url = 11;
      // category of the item
      google.protobuf.StringValue category = 12;
    }

    repeated Item items = 1;
    // Timestamp when Item Context was last updated
    google.protobuf.Timestamp updated_at = 2;
  }

  /** Contains information about the consumer order **/
  message ConsumerOrderDetails {
    // consumer order uuid
    google.protobuf.StringValue consumer_order_uuid = 1;

    // list of links between the consumer order and all associated merchant orders
    repeated MerchantOrderLink merchant_order_links = 5;

    // This link between a consumer order and a merchant order
    enum MerchantOrderLinkType {
      // default value
      MERCHANT_ORDER_LINK_TYPE_UNSPECIFIED = 0;
      // Partial order reorder initiated automatically for INF items within the order
      MERCHANT_ORDER_LINK_TYPE_PARTIAL_AUTO_REORDER = 1;
      // The original mx order that is placed along with the cx order
      MERCHANT_ORDER_LINK_TYPE_ORIGINAL_ORDER = 2;
    }

    // This object is used to link the consumer order with the merchant order
    message MerchantOrderLink {
      // merchant order uuid
      google.protobuf.StringValue merchant_order_uuid = 1;
      // merchant order link type
      MerchantOrderLinkType link_type = 2;
      // merchant order link created time
      google.protobuf.Timestamp updated_at = 3;
    }
  }
}
