syntax = "proto3";
package postal_service.v1;

import "common/code.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";
import "postal_service/postal_service_common.proto";

option go_package = "github.com/doordash/services-protobuf/generated/postal_service";
option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.postal_service";

// Service for voice use cases
service VoiceService {
  // Create a voice call
  rpc CreateVoiceCall(CreateVoiceCallRequest) returns (CreateVoiceCallResponse);
}

// Request for creating a voice call
message CreateVoiceCallRequest {
  // Phone number the voice call made to
  google.protobuf.StringValue phone_number = 1;
  // Country code of the phone number
  google.protobuf.StringValue country_code = 2;
  // Locale information of the voice call
  google.protobuf.StringValue locale = 3;
  // voice call type used to construct webhook URL
  VoiceCallType type = 4;
  // voice call subtype used to construct webhook URL
  VoiceCallSubtype subtype = 5;
  // greeting script
  google.protobuf.StringValue greeting_script = 6;
  // phone tree navigation code
  google.protobuf.StringValue phone_tree_navigation_code = 7;
}

// Response for creating a voice call
message CreateVoiceCallResponse {
  // UUID generated by postal-service for internal tracking and mapping
  google.protobuf.StringValue voice_call_id = 1;
  // Response status code
  code.Code code = 2;
  // Response error message
  google.protobuf.StringValue error_message = 3;
}

// enums for supported voice call types
enum VoiceCallType {
  // default enum is unspecified
  VOICE_CALL_TYPE_UNSPECIFIED = 0;
  // voice call for special hour use cases
  VOICE_CALL_TYPE_SPECIAL_HOUR = 1;
  // voice call to check if store is closed when reported by dasher
  VOICE_CALL_TYPE_DASHER_REPORT_STORE_CLOSED = 2;
  // voice call to provide verification code
  VOICE_CALL_TYPE_VERIFICATION_CODE = 3;
  // voice call to check if store is unable to fulfill orders before deactivate the store
  VOICE_CALL_TYPE_TABLET_HEARTBEAT = 4;
  // voice call to check if dx will continue on the delivery when dasher have problematical status
  VOICE_CALL_TYPE_DX_INTERVENTION = 5;
}

// enums for supported voice call types
enum VoiceCallSubtype {
  // default enum is unspecified
  VOICE_CALL_SUBTYPE_UNSPECIFIED = 0;
  // voice call subtype weather
  VOICE_CALL_SUBTYPE_WEATHER = 1;
  // voice call subtype inquiry
  VOICE_CALL_SUBTYPE_INQUIRY = 2;
  // voice call subtype holiday
  VOICE_CALL_SUBTYPE_HOLIDAY = 3;
  // voice call to check if store is closed when reported by dasher
  VOICE_CALL_SUBTYPE_DRSC = 4;
  // voice call to provide verification code
  VOICE_CALL_SUBTYPE_VERIFICATION_CODE = 5;
  // voice call to check if store is unable to fulfill orders before deactivate the store
  VOICE_CALL_SUBTYPE_TABLET_HEARTBEAT = 6;
  // voice call subtype cancellation
  VOICE_CALL_SUBTYPE_CANCELLATION = 7;
  // voice call subtype Dx offline
  VOICE_CALL_SUBTYPE_DX_OFFLINE = 8;
}

// enums for voice call status
enum VoiceCallStatus {
  // default enum is unspecified
  VOICE_CALL_STATUS_UNSPECIFIED = 0;
  // voice call status initiated
  VOICE_CALL_STATUS_INITIATED = 1;
  // voice call status ringing
  VOICE_CALL_STATUS_RINGING = 2;
  // voice call status answered
  VOICE_CALL_STATUS_ANSWERED = 3;
  // voice call status in-progress
  VOICE_CALL_STATUS_IN_PROGRESS = 4;
  // voice call status completed
  VOICE_CALL_STATUS_COMPLETED = 5;
  // voice call status busy
  VOICE_CALL_STATUS_BUSY = 6;
  // voice call status no-answer
  VOICE_CALL_STATUS_NO_ANSWER = 7;
  // voice call status canceled
  VOICE_CALL_STATUS_CANCELED = 8;
  // voice call status failed
  VOICE_CALL_STATUS_FAILED = 9;
}

// enums for voice call answered by
enum VoiceCallAnsweredBy {
  // default enum is unspecified
  VOICE_CALL_ANSWERED_BY_UNSPECIFIED = 0;
  // voice call answered by machine
  VOICE_CALL_ANSWERED_BY_MACHINE_START = 1;
  // voice call answered by human
  VOICE_CALL_ANSWERED_BY_HUMAN = 2;
  // voice call answered by fax
  VOICE_CALL_ANSWERED_BY_FAX = 3;
  // voice call answered by unknown
  VOICE_CALL_ANSWERED_BY_UNKNOWN = 4;
}

// enums for voice call status reason
enum VoiceCallErrorReason {
  // default enum is unspecified
  VOICE_CALL_ERROR_REASON_UNSPECIFIED = 0;
  // voice call error reason - invalid phone number
  VOICE_CALL_ERROR_REASON_INVALID_PHONE_NUMBER = 1;
}

// Used to track Voice Recording events
message VoiceRecordingEvent {
  // internal event id, unique per step of call
  string dd_event_id = 1;

  // status timestamp
  google.protobuf.Timestamp status_timestamp = 2;

  // unique identifier (provided by the provider) for a specific call
  string call_id = 3;

  // experience of the store
  string experience = 4;

  // store id of the store
  string store_id = 5;

  // country of the store
  string country_code = 6;

  // status of the call (incoming-call, in-progress, etc..)
  string status = 7;

  // current menu of the call
  string menu_id = 8;

  // response captured from caller
  string response = 9;

  // input method (dtmf, speech)
  string input_method = 10;

  // action taken based on the response
  string action = 11;

  // configuration of the action
  string action_configuration = 12;

  // to_number (Should be the owned Voice Recording phone number for the store)
  string to_number = 13;

  // from_number (Caller)
  string from_number = 14;
}
