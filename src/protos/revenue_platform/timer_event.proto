syntax = "proto3";
package revenue_platform.event;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.revenue_platform.event";

// Timer Event generated by Revenue Platform Workflow
message TimerEvent {
  // only one of the following types of timers are allowed
  oneof entity {
    TimerExpired rp_timer_expired = 1;
    PeriodStarted rp_timer_period_started = 2;
    PeriodEnded rp_timer_period_completed = 3;
  }
}

// TimerExpired data object
message TimerExpired {
  string id = 1;
  string name = 2;
  google.protobuf.Timestamp started_at = 3;
  google.protobuf.Timestamp expired_at = 4;
  string aggregator_type = 5;
  string aggregator_id = 6;
}

// period boundary objects
message PeriodStarted {
  string id = 1;
  google.protobuf.Timestamp period_start = 2;
  google.protobuf.Timestamp period_end = 3;
  string aggregator_type = 4;
  string aggregator_id = 5;
}

// period boundary objects
message PeriodEnded {
  string id = 1;
  google.protobuf.Timestamp period_start = 2;
  google.protobuf.Timestamp period_end = 3;
  string aggregator_type = 4;
  string aggregator_id = 5;
}

// types of timer events
enum TimerEventType {
  TIMER_EVENT_TYPE_UNSPECIFIED = 0;
  RP_TIMER_EXPIRED = 1;
  RP_TIMER_PERIOD_STARTED = 2;
  RP_TIMER_PERIOD_ENDED = 3;
}

// Payload for subscription adjustments
message RslSubscriptionAdjustmentEvent {
  string id = 1;
  string adjustment_entity_id = 2;
  string adjustment_entity_type = 3;
  google.protobuf.Timestamp adjustment_start_date = 4;
  google.protobuf.Timestamp adjustment_end_date = 5;
}

// Timer Event payload generated by Timer Service
message UpstreamTimerEvent {
  string id = 1;
  string name = 2;

  google.protobuf.Timestamp fires_at = 4;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.StringValue reference_type = 8;
  google.protobuf.StringValue reference_id = 9;
  // this will contain one of several timer events
  oneof entity {
    // GiftingDailyTimer
    GiftingDailyTimer giftingDailyTimer = 12;
    // SubscriptionDailyTimer
    SubscriptionDailyTimer subscriptionDailyTimer = 13;
  }
  // Bucketing time in Archiver
  google.protobuf.Timestamp buckets_at = 14;

  reserved 5;
  reserved "aggregator_type";

  reserved 6;
  reserved "aggregator_id";

  reserved 10;
  reserved "timer_type";

  reserved 11;
  reserved "dailyTimer";
}

// SubscriptionDailyTimer data
message SubscriptionDailyTimer {
  google.protobuf.Timestamp start_time = 1;
  google.protobuf.Timestamp end_time = 2;
  google.protobuf.DoubleValue plan_fee = 5;
  google.protobuf.StringValue currency = 6;
  // Created at timestamp from SUBSCRIPTION_INVOICE_PAYMENT_SUCCEEDED event
  google.protobuf.Timestamp sip_created_at = 7;
  // Start time of the Free_Periods_created event
  google.protobuf.Timestamp fpc_start_time = 8;
  // End time of the Free_Periods_created event
  google.protobuf.Timestamp fpc_end_time = 9;
  // Grant time of the Free_Periods_created event
  google.protobuf.Timestamp fpc_grant_time = 10;

  reserved 3;
  reserved "remaining_amount";

  reserved 4;
  reserved "booking_amount";

  reserved 11;
  reserved "timer_fires_at";
}

// GiftingDailyTimer data
message GiftingDailyTimer {
  google.protobuf.Timestamp start_time = 1;
  google.protobuf.Timestamp end_time = 2;
  google.protobuf.DoubleValue fee = 3;
  google.protobuf.StringValue country_id = 4;

  reserved 5;
  reserved "timer_fires_at";
}
