syntax = "proto3";

package doordash.test_tenancy_validation_service.v1;

option java_generic_services = true;
option java_multiple_files = true;
option java_package = "com.doordash.rpc.testtenancyvalidation";

// Service that assists in detecting issues with context propagation and data isolation at DoorDash.
service TestTenancyValidationService {
  // Returns the Opentelemetry context propagated to this endpoint via Context.current()
  rpc GetPropagatedContext(GetPropagatedContextRequest) returns (GetPropagatedContextResponse);
}

// Request service to return the propagated context
message GetPropagatedContextRequest {
  // Random uuid generated by caller(integration test) to identify a test run
  string test_execution_id = 1;
}

// Propagated context returned to the caller
message GetPropagatedContextResponse {
  // Otel context object to be returned to caller for verification
  OtelContext otel_context = 1;
}

// Wrapper for Opentelemetry fields to be validated
message OtelContext {
  // W3C trace id https://www.w3.org/TR/trace-context/#trace-id
  string trace_id = 1;
  // W3C baggage: https://www.w3.org/TR/baggage/
  string baggage = 2;
  // Information of the component that propgates the context
  string propagator_id = 3;
}
